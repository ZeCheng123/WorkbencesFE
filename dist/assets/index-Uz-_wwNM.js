import{_ as Y,a as F,b as W}from"./logoXX-KcEG4fMf.js";import{_ as q}from"./download-Dan4AgsM.js";import{c as A,m as j}from"./common-DNv9NPC-.js";import{d as J,g as Z,r as S,a as G,o as K,A as Q,E as $,c as I,h as d,b as l,w as n,e as _,p as R,f as X,i as D,F as ee,q as te,x as ae,j as V,t as oe,_ as le}from"./index-DwwqDRnZ.js";import"./userinfo-B4NFwAcm.js";const v=T=>(R("data-v-756dfd3b"),T=T(),X(),T),se={class:"main"},ne=v(()=>d("span",{class:"header"}," 交付任务 ",-1)),re={class:"search"},de={class:"left"},ce=v(()=>d("span",{style:{width:"336px",height:"32px"}},null,-1)),ie={class:"right"},ue=v(()=>d("img",{src:F,alt:""},null,-1)),me=v(()=>d("img",{src:W,alt:""},null,-1)),pe={class:"table_header"},_e=v(()=>d("span",{class:"left"},[d("img",{src:Y,alt:""}),d("span",{class:"title"})],-1)),fe={class:"right"},he=v(()=>d("img",{src:q,alt:""},null,-1)),ge={style:{display:"flex","align-items":"center"}},be=["onClick"],ve=J({__name:"index",setup(T){const{proxy:g}=Z(),b=S({pageIndex:1,pageSize:15,total:0}),a=G({orderNo:"",customerName:"",customerPhone:"",filterMethod:"",createDate:[],orderStatus:""}),h=S(null),y=S([]);K(()=>{N(!1);const e="100%"/"100%";if(window.addEventListener("resize",Q.debounce(function(){const u=document.body.clientHeight,t=document.body.clientWidth;if(t<1680){const r=u/t;let[c,i]=[0,0];if(r<e){c=u/1080;const m=1920*c,p=t-m;i=p>0?`translate(${p/2}px, 0)`:""}else{c=(t-20)/1920;const m=1080*c,p=u-m;i=p>0?`translate(0, ${p/2}px)`:""}if(r<.52){let m=document.body.clientHeight/c-242*c-10;h.value&&(h.value.style.height=`${m}px`)}else if(h.value){let m=document.body.clientHeight*c+242*c+10;h.value.style.height=`${m}px`}}else h.value&&(h.value.style.height=`calc(${document.body.clientHeight}px - 242px)`)},66)),document.createEvent){var o=document.createEvent("HTMLEvents");o.initEvent("resize",!0,!0),window.dispatchEvent(o)}else typeof Event=="function"&&window.dispatchEvent(new Event("resize"))}),S([{code:"all",name:"全部"},{code:"ServiceCase",name:"服务工单"},{code:"DispatchNote",name:"发货单"},{code:"FieldJob",name:"派工单"}]);const w=S([{code:"",name:"全部"},{code:"0",name:"待开始"},{code:"1",name:"入库"},{code:"3",name:"配送"},{code:"4",name:"安装"},{code:"5",name:"完成"}]),E=e=>{console.log(e),g.$router.push({path:"/delivery_tasks_details",query:{id:e.id,serviceCaseNeoId:e.serviceCaseId,orderId:e.orderId,taskType:e.taskType,status:e.status,distributorName:e.distributorName,followerName:e.followerName,accountName:e.accountNameLabel,createdTime:e.createdTime,createdBy:e.createdBy,mergedOrderNo:e.mergedOrderNo}})},N=e=>{const o=a.orderNo==null?"":a.orderNo,u=a.customerName==null?"":a.customerName,t=a.customerPhone==null?"":a.customerPhone;let c={status:a.orderStatus==null?"":a.orderStatus,createdTimeStart:a.createDate==null?"":a.createDate[0],createdTimeEnd:a.createDate==null?"":a.createDate[1],pageSize:b.value.pageSize,pageNo:b.value.pageIndex,accountName:u,accountPhone:t,taskNumber:o};console.log(c),A(c).then(i=>{let m=i.data.data;m.length>0?(m.forEach(p=>{p.checked=!1,p.taskType="交付"}),y.value=m,e&&$({message:"查询成功",type:"success"})):y.value=[],b.value={pageIndex:i.data.current==null?1:parseInt(i.data.current),pageSize:i.data.size,total:i.data.total}}).catch(i=>{$({message:"请求数据失败，请重试",type:"error"}),console.error("请求数据失败:",i)})},z=e=>{b.value.pageIndex=e,N(!1)},P=()=>{a.orderNo="",a.customerName="",a.customerPhone="",a.filterMethod="",a.createDate=[],a.orderStatus="",N(!1)},B=e=>{y.value.forEach(o=>{o.checked=e})},H=()=>{const e=y.value.filter(t=>t.checked);if(e.length<=0){g.$message.error("必须勾选数据!");return}let o=!1;for(let t=0;t<e.length-1;t++)(e[t].accountName!=e[t+1].accountName||e[t].distributorName!=e[t+1].distributorName)&&(o=!0);if(o){g.$message.error("所选数据并非同一客户同一经销商订单，无法合并!");return}let u={taskIds:e.map(t=>t.id)};j(u).then(t=>{if(t.data.code=="success"){g.$message.success("合并成功!"),console.log("mergeTask",t.data);let r=t.data.data;N(!1),g.$router.push({path:"/delivery_tasks_details",query:{id:r.id,orderId:r.orderId,taskType:r.taskType,status:r.status,distributorName:r.distributorName,followerName:r.followerName,accountName:e[0].accountNameLabel,createdTime:M(new Date),createdBy:r.createdBy,mergedOrderNo:r.mergedOrderNo}})}else g.$message.error("合并失败:"+t.data.message)}).catch(t=>{$({message:"合并失败，请重试",type:"error"}),console.error("合并交付失败:",t)})};function M(e){const o=e.getFullYear(),u=k(e.getMonth()+1),t=k(e.getDate()),r=k(e.getHours()),c=k(e.getMinutes()),i=k(e.getSeconds());return`${o}-${u}-${t} ${r}:${c}:${i}`}function k(e,o=2){return String(e).padStart(o,"0")}return(e,o)=>{const u=_("el-input"),t=_("el-form-item"),r=_("el-form"),c=_("el-date-picker"),i=_("el-option"),m=_("el-select"),p=_("el-button"),C=_("el-checkbox"),f=_("el-table-column"),L=_("el-table"),U=_("el-pagination");return D(),I("div",se,[ne,d("span",re,[d("span",de,[l(r,{model:a,"label-width":"80px","label-position":"left"},{default:n(()=>[l(t,{label:"任务编号"},{default:n(()=>[l(u,{placeholder:"请输入任务编号",modelValue:a.orderNo,"onUpdate:modelValue":o[0]||(o[0]=s=>a.orderNo=s)},null,8,["modelValue"])]),_:1}),l(t,{label:"客户名称"},{default:n(()=>[l(u,{placeholder:"输入客户名称",modelValue:a.customerName,"onUpdate:modelValue":o[1]||(o[1]=s=>a.customerName=s)},null,8,["modelValue"])]),_:1}),l(t,{label:"客户电话"},{default:n(()=>[l(u,{placeholder:"请输入客户电话",modelValue:a.customerPhone,"onUpdate:modelValue":o[2]||(o[2]=s=>a.customerPhone=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),l(r,{model:a,"label-width":"80px","label-position":"left"},{default:n(()=>[l(t,{label:"创建时间"},{default:n(()=>[l(c,{modelValue:a.createDate,"onUpdate:modelValue":o[3]||(o[3]=s=>a.createDate=s),type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(t,{label:"交付状态"},{default:n(()=>[l(m,{modelValue:a.orderStatus,"onUpdate:modelValue":o[4]||(o[4]=s=>a.orderStatus=s),placeholder:"请选择交付状态"},{default:n(()=>[(D(!0),I(ee,null,te(w.value,s=>(D(),ae(i,{key:s.code,label:s.name,value:s.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),ce]),_:1},8,["model"])]),d("span",ie,[l(p,{onClick:o[5]||(o[5]=s=>N(!0)),type:"primary",class:"search_btn"},{icon:n(()=>[ue]),default:n(()=>[V("查询")]),_:1}),l(p,{onClick:o[6]||(o[6]=s=>P()),type:"primary",class:"reset_btn"},{icon:n(()=>[me]),default:n(()=>[V("重置")]),_:1})])]),d("span",pe,[_e,d("span",fe,[l(p,{onClick:o[7]||(o[7]=s=>H()),type:"primary",class:"search_btn"},{default:n(()=>[V("合并交付")]),_:1}),l(p,{type:"primary",class:"reset_btn"},{icon:n(()=>[he]),default:n(()=>[V("下载")]),_:1})])]),d("span",{ref_key:"mainTable",ref:h,class:"table"},[l(L,{class:"table_content",data:y.value,stripe:!1,style:{width:"100%"}},{default:n(()=>[l(f,{prop:"checked",label:"全选",width:"80px"},{header:n(()=>[l(C,{onChange:B},{default:n(()=>[V("全选")]),_:1})]),default:n(s=>[l(C,{modelValue:s.row.checked,"onUpdate:modelValue":x=>s.row.checked=x},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),l(f,{prop:"id",label:"任务编号"}),l(f,{prop:"distributorName",label:"经销商"}),l(f,{prop:"followerName",label:"经销商负责人"}),l(f,{prop:"accountNameLabel",label:"关联客户"}),l(f,{prop:"taskType",label:"任务类型"}),l(f,{prop:"createdTime",label:"创建时间"}),l(f,{prop:"status",label:"状态"},{default:n(s=>{var x;return[d("div",ge,oe(s.row.status?(x=w.value.find(O=>O.code==s.row.status))==null?void 0:x.name:"待开始"),1)]}),_:1}),l(f,{prop:"url",label:"操作",width:"80px"},{default:n(s=>[d("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:x=>E(s.row)}," 查看 ",8,be)]),_:1})]),_:1},8,["data"]),l(U,{class:"table_pagination","page-size":b.value.pageSize,"pager-count":15,layout:"total, prev, pager, next",total:b.value.total,onCurrentChange:z},null,8,["page-size","total"])],512)])}}}),Ve=le(ve,[["__scopeId","data-v-756dfd3b"]]);export{Ve as default};
