import{_ as L,a as W,b as Y}from"./logoXX-KcEG4fMf.js";import{_ as A}from"./download-Dan4AgsM.js";import{c as F,m as O}from"./common-DvLzv8E6.js";import{d as q,g as j,r as x,a as J,o as G,A as K,E as C,c as I,h as r,b as o,w as n,e as p,p as Q,f as R,i as T,F as X,q as Z,x as ee,j as V,t as te,_ as ae}from"./index-CYx_7u_I.js";import"./userinfo-CGvVdpj9.js";const b=S=>(Q("data-v-6a51c3b8"),S=S(),R(),S),oe={class:"main"},le=b(()=>r("span",{class:"header"}," 交付任务 ",-1)),se={class:"search"},ne={class:"left"},re=b(()=>r("span",{style:{width:"336px",height:"32px"}},null,-1)),ce={class:"right"},de=b(()=>r("img",{src:W,alt:""},null,-1)),ie=b(()=>r("img",{src:Y,alt:""},null,-1)),ue={class:"table_header"},me=b(()=>r("span",{class:"left"},[r("img",{src:L,alt:""}),r("span",{class:"title"})],-1)),pe={class:"right"},_e=b(()=>r("img",{src:A,alt:""},null,-1)),he={style:{display:"flex","align-items":"center"}},fe=["onClick"],ge=q({__name:"index",setup(S){const{proxy:v}=j(),f=x({pageIndex:1,pageSize:15,total:0}),e=J({orderNo:"",customerName:"",customerPhone:"",filterMethod:"",createDate:[],orderStatus:""}),h=x(null),y=x([]);G(()=>{N(!1);const t="100%"/"100%";if(window.addEventListener("resize",K.debounce(function(){const m=document.body.clientHeight,a=document.body.clientWidth;if(a<1680){const g=m/a;let[c,u]=[0,0];if(g<t){c=m/1080;const d=1920*c,i=a-d;u=i>0?`translate(${i/2}px, 0)`:""}else{c=(a-20)/1920;const d=1080*c,i=m-d;u=i>0?`translate(0, ${i/2}px)`:""}if(g<.52){let d=document.body.clientHeight/c-242*c-10;h.value&&(h.value.style.height=`${d}px`)}else if(h.value){let d=document.body.clientHeight*c+242*c+10;h.value.style.height=`${d}px`}}else h.value&&(h.value.style.height=`calc(${document.body.clientHeight}px - 242px)`)},66)),document.createEvent){var l=document.createEvent("HTMLEvents");l.initEvent("resize",!0,!0),window.dispatchEvent(l)}else typeof Event=="function"&&window.dispatchEvent(new Event("resize"))}),x([{code:"all",name:"全部"},{code:"ServiceCase",name:"服务工单"},{code:"DispatchNote",name:"发货单"},{code:"FieldJob",name:"派工单"}]);const D=x([{code:"",name:"全部"},{code:"0",name:"待开始"},{code:"1",name:"入库"},{code:"3",name:"配送"},{code:"4",name:"安装"},{code:"5",name:"完成"}]),w=t=>{console.log(t),v.$router.push({path:"/delivery_tasks_details",query:{id:t.id,serviceCaseNeoId:t.serviceCaseId,orderId:t.orderId,taskType:t.taskType,status:t.status,distributorName:t.distributorName,followerName:t.followerName,accountName:t.accountNameLabel,createdTime:t.createdTime,createdBy:t.createdBy,mergedOrderNo:t.mergedOrderNo}})},N=t=>{const l=e.orderNo==null?"":e.orderNo,m=e.customerName==null?"":e.customerName,a=e.customerPhone==null?"":e.customerPhone;let c={status:e.orderStatus==null?"":e.orderStatus,createdTimeStart:e.createDate==null?"":e.createDate[0],createdTimeEnd:e.createDate==null?"":e.createDate[1],pageSize:f.value.pageSize,pageNo:f.value.pageIndex,accountName:m,accountPhone:a,taskNumber:l};console.log(c),F(c).then(u=>{let d=u.data.data;d.length>0?(d.forEach(i=>{i.checked=!1,i.taskType="交付"}),y.value=d,t&&C({message:"查询成功",type:"success"})):y.value=[],f.value={pageIndex:u.data.current==null?1:parseInt(u.data.current),pageSize:u.data.size,total:u.data.total}}).catch(u=>{C({message:"请求数据失败，请重试",type:"error"}),console.error("请求数据失败:",u)})},$=t=>{f.value.pageIndex=t,N(!1)},z=()=>{e.orderNo="",e.customerName="",e.customerPhone="",e.filterMethod="",e.createDate=[],e.orderStatus="",N(!1)},P=t=>{y.value.forEach(l=>{l.checked=t})},H=()=>{const t=y.value.filter(a=>a.checked);if(t.length<=0){v.$message.error("必须勾选数据!");return}let l=!1;for(let a=0;a<t.length-1;a++)(t[a].accountName!=t[a+1].accountName||t[a].distributorName!=t[a+1].distributorName)&&(l=!0);if(l){v.$message.error("所选数据并非同一客户同一经销商订单，无法合并!");return}let m={taskIds:t.map(a=>a.id)};O(m).then(a=>{a.data.code=="success"?(v.$message.success("合并成功!"),console.log("mergeTask",a),N(!1)):v.$message.error("合并失败:"+a.data.message)}).catch(a=>{C({message:"合并失败，请重试",type:"error"}),console.error("合并交付失败:",a)})};return(t,l)=>{const m=p("el-input"),a=p("el-form-item"),g=p("el-form"),c=p("el-date-picker"),u=p("el-option"),d=p("el-select"),i=p("el-button"),E=p("el-checkbox"),_=p("el-table-column"),B=p("el-table"),M=p("el-pagination");return T(),I("div",oe,[le,r("span",se,[r("span",ne,[o(g,{model:e,"label-width":"80px","label-position":"left"},{default:n(()=>[o(a,{label:"任务编号"},{default:n(()=>[o(m,{placeholder:"请输入任务编号",modelValue:e.orderNo,"onUpdate:modelValue":l[0]||(l[0]=s=>e.orderNo=s)},null,8,["modelValue"])]),_:1}),o(a,{label:"客户名称"},{default:n(()=>[o(m,{placeholder:"输入客户名称",modelValue:e.customerName,"onUpdate:modelValue":l[1]||(l[1]=s=>e.customerName=s)},null,8,["modelValue"])]),_:1}),o(a,{label:"客户电话"},{default:n(()=>[o(m,{placeholder:"请输入客户电话",modelValue:e.customerPhone,"onUpdate:modelValue":l[2]||(l[2]=s=>e.customerPhone=s)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),o(g,{model:e,"label-width":"80px","label-position":"left"},{default:n(()=>[o(a,{label:"创建时间"},{default:n(()=>[o(c,{modelValue:e.createDate,"onUpdate:modelValue":l[3]||(l[3]=s=>e.createDate=s),type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),o(a,{label:"交付状态"},{default:n(()=>[o(d,{modelValue:e.orderStatus,"onUpdate:modelValue":l[4]||(l[4]=s=>e.orderStatus=s),placeholder:"请选择交付状态"},{default:n(()=>[(T(!0),I(X,null,Z(D.value,s=>(T(),ee(u,{key:s.code,label:s.name,value:s.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),re]),_:1},8,["model"])]),r("span",ce,[o(i,{onClick:l[5]||(l[5]=s=>N(!0)),type:"primary",class:"search_btn"},{icon:n(()=>[de]),default:n(()=>[V("查询")]),_:1}),o(i,{onClick:l[6]||(l[6]=s=>z()),type:"primary",class:"reset_btn"},{icon:n(()=>[ie]),default:n(()=>[V("重置")]),_:1})])]),r("span",ue,[me,r("span",pe,[o(i,{onClick:l[7]||(l[7]=s=>H()),type:"primary",class:"search_btn"},{default:n(()=>[V("合并交付")]),_:1}),o(i,{type:"primary",class:"reset_btn"},{icon:n(()=>[_e]),default:n(()=>[V("下载")]),_:1})])]),r("span",{ref_key:"mainTable",ref:h,class:"table"},[o(B,{class:"table_content",data:y.value,stripe:!1,style:{width:"100%"}},{default:n(()=>[o(_,{prop:"checked",label:"全选",width:"80px"},{header:n(()=>[o(E,{onChange:P},{default:n(()=>[V("全选")]),_:1})]),default:n(s=>[o(E,{modelValue:s.row.checked,"onUpdate:modelValue":k=>s.row.checked=k},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(_,{prop:"id",label:"任务编号"}),o(_,{prop:"distributorName",label:"经销商"}),o(_,{prop:"followerName",label:"经销商负责人"}),o(_,{prop:"accountNameLabel",label:"关联客户"}),o(_,{prop:"taskType",label:"任务类型"}),o(_,{prop:"createdTime",label:"创建时间"}),o(_,{prop:"status",label:"状态"},{default:n(s=>{var k;return[r("div",he,te(s.row.status?(k=D.value.find(U=>U.code==s.row.status))==null?void 0:k.name:"待开始"),1)]}),_:1}),o(_,{prop:"url",label:"操作",width:"80px"},{default:n(s=>[r("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:k=>w(s.row)}," 查看 ",8,fe)]),_:1})]),_:1},8,["data"]),o(M,{class:"table_pagination","page-size":f.value.pageSize,"pager-count":15,layout:"total, prev, pager, next",total:f.value.total,onCurrentChange:$},null,8,["page-size","total"])],512)])}}}),xe=ae(ge,[["__scopeId","data-v-6a51c3b8"]]);export{xe as default};
