import{_ as nl,a as dl,b as cl}from"./tips-DfmWQaVF.js";import{_ as rl}from"./add-CRTT_dyr.js";import{d as il,g as ul,r as i,z as pl,a as ne,o as ml,E as B,c as D,h as a,b as o,w as c,v as V,j as k,t as h,u as b,q as E,F as N,m as x,e as L,p as vl,f as _l,i as v,s as w,x as ta,A as fl,C as hl,_ as bl}from"./index-BNw8j_YZ.js";import{p as gl,h as sa,H as ke,I as oa,i as yl,x as kl,k as Cl,e as Ce,y as wl,J as Tl,t as Sl,n as Il,f as Dl,v as Vl}from"./common-DZytvcl-.js";import{h as na}from"./moment-Cl4UOzQZ.js";import"./userinfo-CbCawm5q.js";const m=ee=>(vl("data-v-50463321"),ee=ee(),_l(),ee),Nl={class:"main"},Pl={class:"header"},xl={class:"title"},Ll=m(()=>a("span",null,"问题提报状态",-1)),Ul={class:"step"},ql={class:"item"},$l={class:"item"},Ol={class:"item"},Al={class:"item"},Fl={class:"problem_report_info"},Ml={class:"title"},Jl={class:"titleDateTime"},Rl={class:"main_field"},El={class:"row_field"},Bl={class:"field"},Yl=m(()=>a("span",{class:"label"},"问题编号：",-1)),jl={class:"value"},zl={class:"field"},Hl=m(()=>a("span",{class:"label"},"专卖店名称：",-1)),Wl={class:"value"},Xl={class:"field"},Gl=m(()=>a("span",{class:"label"},"问题类别：",-1)),Kl={class:"value"},Ql={class:"row_field"},Zl={class:"field"},et=m(()=>a("span",{class:"label"},"订单编号：",-1)),at={class:"value"},lt={class:"field"},tt=m(()=>a("span",{class:"label"},"负责人：",-1)),st={class:"value"},ot={class:"field"},nt=m(()=>a("span",{class:"label"},"创建时间：",-1)),dt={class:"value"},ct={class:"row_field"},rt={class:"field"},it=m(()=>a("span",{class:"label"},"问题描述：",-1)),ut={class:"value"},pt={class:"field"},mt=m(()=>a("span",{class:"label"},"来源：",-1)),vt={class:"value"},_t={class:"field"},ft=m(()=>a("span",{class:"label"},"提报人：",-1)),ht={class:"value"},bt={class:"row_field"},gt={class:"field"},yt=m(()=>a("span",{class:"label"},"提报人电话：",-1)),kt={class:"value"},Ct={class:"field"},wt=m(()=>a("span",{class:"label"},"购买门店名称：",-1)),Tt={class:"value"},St=m(()=>a("span",{class:"title"},"其他字段",-1)),It={class:"other_field"},Dt={class:"row_field"},Vt={class:"field"},Nt=m(()=>a("span",{class:"label"},"客户姓名：",-1)),Pt={class:"value"},xt={class:"field"},Lt=m(()=>a("span",{class:"label"},"客户手机号：",-1)),Ut={class:"value"},qt={class:"field"},$t=m(()=>a("span",{class:"label"},"经销商处理结论：",-1)),Ot={class:"value"},At={class:"row_field"},Ft={class:"field"},Mt=m(()=>a("span",{class:"label"},"省份：",-1)),Jt={class:"value"},Rt={class:"field"},Et=m(()=>a("span",{class:"label"},"城市：",-1)),Bt={class:"value"},Yt={class:"field"},jt=m(()=>a("span",{class:"label"},"区：",-1)),zt={class:"value"},Ht={class:"row_field"},Wt={class:"field"},Xt=m(()=>a("span",{class:"label"},"经销商内部提报：",-1)),Gt={class:"related_documents"},Kt=m(()=>a("span",{class:"title"},"相关单据",-1)),Qt={class:"action_list"},Zt=m(()=>a("img",{src:nl,alt:""},null,-1)),es={class:"right"},as={class:"userinfo"},ls=m(()=>a("img",{src:dl,alt:""},null,-1)),ts={class:"username"},ss={class:"content"},os={class:"date"},ns=m(()=>a("span",{class:"reply"},"回复",-1)),ds=m(()=>a("img",{class:"tips",src:cl,alt:""},null,-1)),cs={class:"showMainDialog"},rs={class:"step"},is={class:"item"},us=m(()=>a("span",{class:"name"},[k("确认问题订单 "),a("span",{class:"remark"},"选择或确认问题订单")],-1)),ps={class:"item"},ms=m(()=>a("span",{class:"name"},[k("完善必填信息 "),a("span",{class:"remark"},"完善问题描述与处理方式")],-1)),vs={class:"item"},_s=m(()=>a("span",{class:"name"},[k("提交升级 "),a("span",{class:"remark"},"提交售后至总部")],-1)),fs={class:"form_row_shengji"},hs=m(()=>a("span",{class:"label required"},"订单编号:",-1)),bs={class:"form_row_shengji"},gs=m(()=>a("span",{class:"label required"},"经销商需求描述:",-1)),ys=m(()=>a("div",{class:"search"},[a("span",{class:"label required"},"客户历史售后工单")],-1)),ks={class:"table"},Cs=["onClick"],ws={style:{display:"flex","align-items":"center"}},Ts=["onClick"],Ss={class:"desc_action"},Is=m(()=>a("span",{class:"desc"},"搜索和选择/批量编辑问题产品",-1)),Ds={class:"action"},Vs={class:"filter_list"},Ns={class:"table"},Ps={style:{display:"flex","align-items":"center"}},xs={class:"responsibilityPerson"},Ls=m(()=>a("span",{class:"label required"},"问题大类",-1)),Us=m(()=>a("span",{class:"label required"},"售后问题",-1)),qs=m(()=>a("span",{class:"label required"},"责任人",-1)),$s={class:"responsibilityPerson"},Os=m(()=>a("span",{class:"label required"},"问题描述",-1)),As=m(()=>a("div",{class:"responsibilityPerson"},[a("span",{class:"label"},"上传文件")],-1)),Fs={class:"containerUpload"},Ms={class:"item"},Js={class:"dialog-footer"},Rs={class:"deliveryOrderDialog"},Es={class:"step"},Bs={class:"item"},Ys=m(()=>a("span",{class:"remark"},"选择维修工程师",-1)),js={class:"item"},zs=m(()=>a("span",{class:"remark"},"如有,请填写关键备注",-1)),Hs={class:"item"},Ws=m(()=>a("span",{class:"remark"},"等待司机配送",-1)),Xs={class:"content"},Gs=m(()=>a("img",{src:rl,alt:""},null,-1)),Ks=[Gs],Qs={class:"dialog-footer"},Zs={class:"editcontentDialog"},eo={class:"content"},ao={class:"dialog-footer"},lo={class:"relatedDocumentsDialog"},to={class:"content"},so={class:"tableItem"},oo=m(()=>a("span",{class:"tableTitle"}," 1. 售后工单 ",-1)),no={class:"tableContent"},co={style:{display:"flex","align-items":"center"}},ro=["onClick"],io={class:"tableItem"},uo=m(()=>a("span",{class:"tableTitle"}," 2. 派工单 ",-1)),po={class:"tableContent"},mo={style:{display:"flex","align-items":"center"}},vo={style:{display:"flex","align-items":"center",color:"blue"}},_o=["onClick"],fo={class:"tableItem"},ho=m(()=>a("span",{class:"tableTitle"}," 3. 问题提报附件 ",-1)),bo={class:"tableContent"},go={class:"dialog-footer"},yo=il({__name:"index",setup(ee){const{proxy:C}=ul(),we=new Date,da=i([]),U=i(1),q=pl(),de=i(q.query.id),W=i(q.query.neoid);let Te=null;const ca=q.query.status!=null?parseInt(q.query.status.toString(),0)+1:1,ae=i(!1),ra=i([]),X=i([]),ia=i([]),G=i(!1),ua=i(!1),le=i(!1),$=i([]),j=i([]),K=i([]);i([]);const n=i({}),Se=i([]),Ie=i([]),De=i([]),ce=i(!1);let Q="",re=i(),te=0,ie="";const ue=i([]);let pe=null;const p=i({orderNo:"",remark:"",searchValue:"",orderType:"",productType:"",productModel:"",treeSpecies:"",paintColor:"",size:""}),S=i({serviceTicketId:0,problemType:"",afterSalesIssues:[],responsiblePerson:"",problemDesc:"",fileList:[],filePath:[],poductType:"",componentType:"",badType:"",qualityIndicator1:"",qualityIndicator2:"",handleWay:""}),pa=i([{label:"清除",value:"1"}]),Ve=i([{label:"全部产品大类",value:"1"}]),Ne=i([{label:"全部产品型号",value:"1"}]),Pe=i([{label:"全部树种",value:"1"}]),xe=i([{label:"全部油漆颜色",value:"1"}]),Le=i([{label:"全部尺寸",value:"1"}]),z=i([]),ma=t=>{console.log(t),t.code=="success"&&(z.value=z.value.concat(t.data.map(e=>e.fileId)))},va=t=>{var e=t.response;if(e.code=="success"){const s=e.data[0].fileId,d=z.value.findIndex(g=>g===s);d!==-1&&z.value.splice(d,1)}},Ue=i(),_a=i([]),qe=t=>{console.info("选择的数据：",t),_a.value=t};i([]),i([{text1:"SU2024030101",text2:"已评价",text3:"其他",text4:"满意",text5:"2021-02-28 10:30:50",text6:""}]);const $e=i([{code:"1",name:"经销商问题"},{code:"2",name:"公司问题"},{code:"3",name:"物流问题"}]),Oe=i([{code:"1",name:"店面测量师漏单"},{code:"2",name:"店面测量师量错"},{code:"3",name:"店里设计师漏分解"},{code:"4",name:"店里设计师分解错"},{code:"5",name:"店里设计不合理"},{code:"6",name:"店里下单员漏单"},{code:"7",name:"店里下单员下错"},{code:"8",name:"店里安装师问题"},{code:"9",name:"消费者补单"},{code:"10",name:"消费者使用不当"},{code:"11",name:"产品丢失"},{code:"12",name:"公司问题"},{code:"13",name:"物流问题"}]),Ae=i([]),fa=i({1:[{code:"1",name:"店面测量师漏单"},{code:"2",name:"店面测量师量错"},{code:"3",name:"店里设计师漏分解"},{code:"4",name:"店里设计师分解错"},{code:"5",name:"店里设计不合理"},{code:"6",name:"店里下单员漏单"},{code:"7",name:"店里下单员下错"},{code:"8",name:"店里安装师问题"},{code:"9",name:"消费者补单"},{code:"10",name:"消费者使用不当"},{code:"11",name:"产品丢失"}],2:[{code:"12",name:"公司问题"}],3:[{code:"13",name:"物流问题"}]});i([{code:"1",name:"墙板"},{code:"2",name:"线条"},{code:"3",name:"五金"},{code:"4",name:"门套"},{code:"5",name:"门扇"},{code:"6",name:"柜体"},{code:"7",name:"柜门"},{code:"8",name:"玻璃"},{code:"9",name:"挂板"},{code:"10",name:"罗马柱"},{code:"11",name:"帽头"},{code:"12",name:"装饰块"},{code:"13",name:"雕花件"},{code:"14",name:"色板"},{code:"15",name:"整单"},{code:"16",name:"入户门"}]),i([{code:"1",name:"边梃"},{code:"2",name:"挂线条"},{code:"3",name:"芯板"},{code:"4",name:"金属条"},{code:"5",name:"码头"},{code:"6",name:"封边"},{code:"7",name:"L边"},{code:"8",name:"整体"},{code:"9",name:"面板执手"},{code:"10",name:"锁体"},{code:"11",name:"铰链"},{code:"12",name:"铰链底座"},{code:"13",name:"灯带"},{code:"14",name:"抽屉轨道"},{code:"15",name:"三合一"},{code:"16",name:"其他五金"},{code:"17",name:"档条"},{code:"18",name:"密封条"},{code:"19",name:"套板"},{code:"20",name:"门套"},{code:"21",name:"玻璃"},{code:"22",name:"门标"},{code:"23",name:"门芯板"},{code:"24",name:"配件"},{code:"25",name:"五金配件"},{code:"26",name:"8属边"},{code:"27",name:"背板"},{code:"28",name:"层板"},{code:"29",name:"抽屉板"},{code:"30",name:"底板"},{code:"31",name:"顶板"},{code:"32",name:"台面板"},{code:"33",name:"立板"},{code:"34",name:"侧板"},{code:"35",name:"踢脚板"},{code:"36",name:"五金件"},{code:"37",name:"挂板"},{code:"38",name:"罗马柱"},{code:"39",name:"帽头"},{code:"40",name:"装饰块"},{code:"41",name:"雕花件"},{code:"42",name:"色板"},{code:"43",name:"整单"},{code:"44",name:"修补漆"},{code:"45",name:"入户门扇"}]),i([{code:"1",name:"消费者"},{code:"2",name:"经销商"},{code:"3",name:"订单分解"},{code:"4",name:"备料"},{code:"5",name:"加工"},{code:"6",name:"免漆加工"},{code:"7",name:"油漆"},{code:"8",name:"少货"},{code:"9",name:"包装问题"},{code:"10",name:"五金问题"},{code:"11",name:"辅料问题"},{code:"12",name:"仓库发货"},{code:"13",name:"物流送达"},{code:"14",name:"系统问题"},{code:"15",name:"新品设计问题"},{code:"16",name:"隔音等级"},{code:"17",name:"受潮"},{code:"18",name:"无法提供证明的少货"},{code:"19",name:"交期延误"},{code:"20",name:"霉变"},{code:"21",name:"气味"},{code:"22",name:"长虫"},{code:"23",name:"过质保期"},{code:"24",name:"变色"},{code:"25",name:"入户门问题"}]),i({}),i([{code:"1",name:"订单分解错"},{code:"2",name:"订单漏分解"},{code:"3",name:"变形"}]),i([{code:"1",name:"漏备注"},{code:"2",name:"产品漏分解"},{code:"3",name:"配件漏分解"},{code:"4",name:"五金漏分解"},{code:"5",name:"孔位漏分解"}]),i([{label:"处理方式",value:"1"}]);const me=i([]),ha=i([{code:"1",name:"配送技工"},{code:"2",name:"安装技工"},{code:"3",name:"客户"},{code:"4",name:"经销商"}]),ba=i([{code:"0",name:"配送派工"},{code:"1",name:"安装派工"},{code:"2",name:"维修"}]),ga=i([{code:"1",name:"最高"},{code:"2",name:"高"},{code:"3",name:"中"},{code:"4",name:"低"}]),ya=i([{code:"0",name:"配送派工单"},{code:"1",name:"安装派工单"},{code:"2",name:"维修派工单"}]),ka=i([{code:"0",name:"待开始"},{code:"1",name:"进行中"},{code:"2",name:"已完成"}]),Fe=i([{code:"",name:"全部"},{code:"1",name:"开始"},{code:"2",name:"已提报问题"},{code:"3",name:"售后审核"},{code:"4",name:"已定损"},{code:"5",name:"定责发起"},{code:"6",name:"已提交OA审批"},{code:"7",name:"已追责"},{code:"8",name:"已追责"},{code:"8",name:"结束"}]),M=i(1),H=i(!1),Ca=i(!1),wa=i(1),Ta=()=>{G.value=!0},Me=i({files:[],name:"files"}),Je=i({files:[],name:"files"}),Sa=t=>{Je.value.files=[t]},Ia=t=>{Me.value.files=[t]};i({value1:"1",value2:"1",value3:"1",value4:"1",value5:"1",value6:"1"});const Da=()=>{U.value=2},ve=i({taskid:q.query.id,serviceCaseNeoId:q.query.serviceCaseId,orderId:q.query.orderId,taskStatus:ca,accountName:q.query.accountName,distributorName:q.query.distributorName,followerName:q.query.followerName,createdTime:q.query.createdTime,createdBy:q.query.createdBy});let _=ne({fieldJobContactName:"",contactTelephone:"",priority:"",type:"2",remark:"",appointmentStartTime:"",appointmentEndTime:"",haveInstallConditions:!1,fieldJobOrderId:q.query.orderId,fieldJobType__c:"2",stage__c:0,name:ve.value.accountName+"的配送派工单",fileList:[],filePath:[],followerId:null,address:"",source__c:1});const Re=ne({followerId:[{required:!0,message:"Please input username",trigger:"blur"}],fieldJobContactName:[{required:!0,message:"Please input username",trigger:"blur"}],contactTelephone:[{required:!0,message:"Please input phone",trigger:"blur"}],priority:[{required:!0,message:"Please input priority",trigger:"blur"}],appointmentStartTime:[{required:!0,message:"Please input appointment start time",trigger:"blur"}],appointmentEndTime:[{required:!0,message:"Please input appointment end time",trigger:"blur"}]}),Va=t=>{t.response},Na=t=>{if(t.code=="success"){let e=t.data.map(s=>s.fileId);e[0]&&_.filePath.push(e[0])}};let T=ne({processingProcessAndResults:"",followerId:null});const Pa=ne({followerId:[{required:!0,message:"请选择负责人",trigger:"blur"}],processingProcessAndResults:[{required:!0,message:"请输入经销商处理结论",trigger:"blur"}]});i({files:[],name:"files"});const Ee=i({Content:"application/json",Authorization:"",isImage:"true",needFileId:"true","Trace-Id":""}),Be=t=>{Cl({userType:1,name:"",phone:""}).then(s=>{let d=s.data.data;d!=null&&d.length>0?(X.value=d,t&&B({message:"查询成功",type:"success"})):t&&B({message:"获取数据失败",type:"error"})})},xa=t=>{let e=X.value.find(s=>s.id==t);e&&(T.follower=e.neoId,T.followerName=e.name)},La=t=>{let e=X.value.find(s=>s.id==t);e&&(_.fieldJobContactName=e.name,_.contactTelephone=e.phone)},Ua=()=>{let t={followerId:T.followerId==null?n.value.followerId:T.followerId,follower:T.follower==null?n.value.follower:T.follower,followerName:T.followerName==null?n.value.followerName:T.followerName,processingProcessAndResults:T.processingProcessAndResults==null?n.value.processingProcessAndResults:T.processingProcessAndResults,id:de.value,questionType:n.value.questionType,name:n.value.name,caseStatus:n.value.caseStatus};Ce(t).then(e=>{let s=e.data;s.code=="success"&&s.data!=null?(n.value.followerName=T.followerName,n.value.processingProcessAndResults=T.processingProcessAndResults,Object.keys(T).forEach(d=>{d!=="followerId"&&(T[d]=""),d=="followerId"&&(T[d]=null)}),C.$message.success("保存成功")):C.$message.warning("保存失败")})};i([]);const se=i([]);ml(()=>{je(),We(),Xe(),Ge(),ze(),Be(!1),ge(),be()});const Ye=()=>{je(),We(),Xe(),Ge(),ze(),Be(!1),ge(),be()},je=()=>{gl({id:de.value,neoid:W.value==null?"":W.value}).then(t=>{let e=t.data;if(e.code=="success"){n.value=e.data,p.value.orderNo=n.value.caseNo,te=n.value.caseStatus,T.processingProcessAndResults=n.value.processingProcessAndResults,ce.value=n.value.complaintSourceC.toString()=="4";var s="https://sh.mengtian.com.cn:9595/md/api/common/file/direct-download?fileId=";if(n.value.picture!=null&&n.value.picture.length>0){var d=[];n.value.picture.forEach(g=>{d.push(s+g)}),ue.value.push({picNo:n.value.picture.join(","),type:"问题提报图片",picture:d})}if(te===2){let g=n.value.dealerAcceptanceTime,I=new Date(g).getTime()+24*60*60*1e3;re=i(Math.floor((I-Date.now())/1e3)),qa(re,I)}Wa(e.data.orderNeoId)}else C.$message.error(e==null?void 0:e.message)})},qa=(t,e)=>{const s=setInterval(()=>{t.value=Math.floor((e-Date.now())/1e3),t.value<=0&&(clearInterval(s),ie="已受理阶段大于24小时")},1e3)},$a=t=>{const e=Math.floor(t/3600),s=Math.floor(t%3600/60),d=t%60;return ie||`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${d.toString().padStart(2,"0")}`},_e=t=>{U.value=t},ze=()=>{sa({deliveryDate:"",status__c:"",orderType__c:"",transactionDate:"",po:"",accountName:"",accountPhone:""}).then(e=>{let s=e.data;s.code=="success"?ra.value=s.data:C.$message.error(s==null?void 0:s.message)})},Oa=()=>{if($.value.forEach(e=>{e.checked=!1}),n.value.orderNeoId==null||n.value.orderNeoId.toString().length<=0){C.$message.warning("此问题提报未绑定订单，无法升级售后!");return}S.value=i([]),H.value=!0;let t={orderNoeId:n.value.orderNeoId};oa(t).then(e=>{let s=e.data;s.code=="success"?(s.data.forEach(d=>{d.serviceCaseNeoId==n.value.neoid?d.operate=!0:d.operate=!1}),K.value=s.data,K.value.forEach(d=>{d.checked=!1})):C.$message.error(s==null?void 0:s.message)})},fe=t=>{M.value=t},He=t=>{wa.value=t,H.value=!1,Ca.value=!0},Aa=()=>{const t=K.value.filter(d=>d.checked&&d.operate);let e="是否新建售后工单?",s="新建售后工单";if(t.length>1){C.$message.warning("只能勾选一条已绑定的售后工单");return}t.length==1&&(e="是否对所选售后工单进行编辑?",s="编辑售后工单"),fl.confirm(e,s,{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{!p.value.remark&&t.length<=0?C.$message.error("经销商需求描述不能为空!"):t.length==1?he(t[0],!0):he(null,!1)}).catch(()=>{})},Fa=()=>{console.info("fileIdfileId",z.value);const t=j.value.filter(d=>d.checked);if(t.length<=0){C.$message.error("必须勾选数据!");return}let e=JSON.parse(JSON.stringify(t));e.forEach(d=>{d.picture=z.value,d.orderProductId=d.neoid,d.treeSpecies=d.treeSpecies__c,d.category=d.category1,d.paintColor=d.paintColor__c,d.ticketClassification=S.value.problemType,d.ticketProblem=S.value.afterSalesIssues,d.personLiable=S.value.responsiblePerson,d.descriptionOfTicketProblem=S.value.problemDesc,d.id=Q!=""?d.solutionDetailsId:null});let s={serviceTicket:Y.value.id,serviceTicketId:Y.value.neoId,serviceCaseId:parseInt(n.value.neoid),details:e};Q!=""&&(s.id=Q),console.info("selectDataselectData",t),!S.value.problemType||!S.value.afterSalesIssues||!S.value.responsiblePerson||!S.value.problemDesc?C.$message.error("必填选项不能为空!"):(C.$message.success("提交成功!"),setTimeout(()=>{H.value=!1,M.value=1,wl(s).then(d=>{console.log(d);let g=d.data.data;if(g!=null){Q=g.id;let u=g.details;u&&u.length>0&&t.forEach(I=>{let r=u.find(f=>I.neoid==f.orderProductId);if(r){I.descriptionOfTicketProblem=r.descriptionOfTicketProblem,I.ticketClassification=r.ticketClassification;let f="";r.ticketProblem.forEach(O=>{f=f+Oe.value.find(A=>A.code==O).name+","}),I.ticketProblem=f.substring(0,f.length-1),I.responsibleSubject=r.responsibleSubject,I.solutionDetailsId=r.id}})}})},500))},Ma=()=>{ua.value=!0},Ja=()=>{if(n.value.caseStatus=="5"){C.$message.warning("问题提报已完成，无法修改");return}if(se.value.filter(e=>parseInt(e.status__c)>=2).length>0){C.$message.warning("存在处理中的售后工单,不允许修改");return}le.value=!0},We=()=>{ke("province").then(t=>{let e=t.data;e.code=="success"&&(Se.value=e.data)})},Xe=()=>{ke("city").then(t=>{let e=t.data;e.code=="success"&&(Ie.value=e.data)})},Ge=()=>{ke("district").then(t=>{let e=t.data;e.code=="success"&&(De.value=e.data)})},Ke=t=>{sa({po:t}).then(s=>{if(s.data.code=="success"){let d=s.data.data[0].id,g=s.data.data[0].po;Te=parseInt(Y.value.neoId),Dl(d).then(u=>{let I=u.data.data.items;$.value=I,$.value.forEach(r=>{r.checked=!1,r.orderPo=g}),Vl(Te).then(r=>{if(r.data.code=="success"&&r.data.data!=null){Q=r.data.data.id;let f=r.data.data.details;f&&f.length>0?$.value.forEach(O=>{let A=f.find(J=>O.neoid==J.orderProductId);if(A){O.descriptionOfTicketProblem=A.descriptionOfTicketProblem,O.ticketClassification=A.ticketClassification;let J="";A.ticketProblem.forEach(F=>{J=J+Oe.value.find(oe=>oe.code==F).name+","}),O.ticketProblem=J.substring(0,J.length-1),O.responsibleSubject=A.responsibleSubject,O.solutionDetailsId=A.id,O.note=A.note}}):console.info("details没数据")}}),j.value=$.value,Ve.value=[[{label:"全部产品大类",value:"1"}],[...new Set($.value.map(r=>r.category1))].map(r=>({label:r,value:r}))].reduce((r,f)=>r.concat(f),[]).filter(r=>r.label!=""),Ne.value=[[{label:"全部产品型号",value:"1"}],[...new Set($.value.map(r=>r.fscProductModel))].map(r=>({label:r,value:r}))].reduce((r,f)=>r.concat(f),[]).filter(r=>r.label!=""),Le.value=[[{label:"全部尺寸",value:"1"}],[...new Set($.value.map(r=>r.fscProductSpec))].map(r=>({label:r,value:r}))].reduce((r,f)=>r.concat(f),[]).filter(r=>r.label!=""),xe.value=[[{label:"全部油漆颜色",value:"1"}],[...new Set($.value.map(r=>r.paintColor__c))].map(r=>({label:r,value:r}))].reduce((r,f)=>r.concat(f),[]).filter(r=>r.label!=""),Pe.value=[[{label:"全部树种",value:"1"}],[...new Set($.value.map(r=>r.treeSpecies__c))].map(r=>({label:r,value:r}))].reduce((r,f)=>r.concat(f),[]).filter(r=>r.label!="")})}else C.$message.error("数据异常!")})},Y=i({}),he=(t,e)=>{if(!p.value.remark&&!e){C.$message.error("经销商需求备注不能为空!");return}let s={},d=!0;if(t!=null)s={id:t.id,neoId:t.neoId,serviceCase__c:n.value.neoid,serviceCaseNeoId:n.value.neoid,distributorDemands__c:e==!0?t.distributorDemands__c:p.value.remark},d=!1;else{const g=sessionStorage.getItem("userinfo");let u=null;g&&(u=JSON.parse(g)),s={serviceCase__c:n.value.neoid,serviceCaseNeoId:n.value.neoid,distributorDemands__c:p.value.remark,problemDescription__c:n.value.problemDescription,customerPhone__c:n.value.phone,accountName:n.value.caseAccountName,customerAddress__c:n.value.address,accountNeoId:n.value.caseAccountId,distributorNeoId:n.value.distributorNeoId,distributorName:n.value.distributorName,distributorNo:P.value.distributorNo,storeNeoId:n.value.storeNeoId,storeName:n.value.storeName,storeNo:P.value.storeNo,status__c:"2",reporter__c:u?u.name:"",reporterPhone__c:u?u.phone:"",ticketSource__c:"1",orderNeoId:P.value.neoid,orderType__c:P.value.orderType__c,productionOrderNo__c:P.value.productionOrderNo__c,region__c:P.value.region__c}}Tl(s).then(g=>{let u=g.data;if(u.code=="success"&&u.data!=null&&u.data.id!=null){if(d)Qe(u.data.id);else if(t.operate=!0,Y.value=t,M.value=2,Ke(p.value.orderNo),n.value.caseStatus===2){let I={id:n.value.id,questionType:n.value.questionType,name:n.value.name,caseStatus:3,dealerProcessingTime:na().format("YYYY-MM-DD HH:mm:ss"),processingProcessAndResults:p.value.remark};ea(I),setTimeout(()=>{Ye()},100)}e||B({message:"绑定售后工单成功",type:"success"})}else B({message:"绑定售后工单失败,请重试",type:"error"})}).catch(g=>{B({message:"绑定售后工单失败,请重试",type:"error"})})},Qe=t=>{Ra(),Sl(t).then(e=>{e.data.code=="success"&&e.data.data.neoId!=null?(Y.value=e.data.data,Y.value.operate=!0,K.value.push(Y.value),pe.close(),M.value=2,Ke(p.value.orderNo)):setTimeout(()=>{Qe(t)},1e3)}).catch(e=>{console.error("Error checking sync status:",e)})},Ra=()=>{pe==null&&(pe=hl.service({fullscreen:!0,lock:!0,text:"等待数据同步完成",background:"rgba(0, 0, 0, 0.7)"}))},be=()=>{let t={serviceCaseNeoId:W.value};oa(t).then(e=>{let s=e.data.data;e.data.code=="success"&&(se.value=s)}).catch(e=>{B({message:"请求数据失败，请重试",type:"error"})})},Ze=t=>{C.$router.push({path:"/aftersales_workorder_details",query:{id:t.id}})},ge=()=>{let t={serviceCaseNeoId:W.value};yl(t).then(e=>{let s=e.data.data;e.data.code=="success"&&(me.value=s)}).catch(e=>{B({message:"请求数据失败，请重试",type:"error"})})},Ea=t=>{C.$router.push({path:"/dispatch_details",query:{id:t.id}})},Ba=()=>{ae.value=!0,ge(),be()},Ya=()=>{let t=_;t.fieldJobContactName=ve.value.accountName==null?"":ve.value.accountName.toString(),t.serviceCaseName=parseInt(W.value),t.fieldJobOrderId=P.value.neoid,t.contactTelephone=P.value.contactTel,t.fieldJobContactName=P.value.accountName__C,t.name=P.value.accountName__C+"的维修派工单",t.orderNo__c=P.value.po,t.picture=t.filePath,t.goodsPicture=t.filePath,t.status=1,t.address=P.value.customerAddress,Il(t).then(e=>{let s=e.data.data;if(ia.value.push(s),s!=null){if(n.value.caseStatus===2){let d={id:n.value.id,questionType:n.value.questionType,name:n.value.name,caseStatus:3,dealerProcessingTime:na().format("YYYY-MM-DD HH:mm:ss")};ea(d),setTimeout(()=>{Ye()},500)}B({message:"新增派工单成功",type:"success"})}else B({message:"新增派工单失败",type:"error"});Object.keys(_).forEach(d=>{!d.includes("type")&&!d.includes("haveInstallConditions")&&d!=="fieldJobOrderId"&&d!=="fieldJobType__c"&&d!=="stage__c"&&d!=="name"&&(_[d]=""),d==="haveInstallConditions"&&(_[d]=!1),(d=="fileList"||d=="filePath")&&(_[d]=[])})}).catch(e=>{B({message:"请求新增派工单失败，请重试",type:"error"}),Object.keys(_).forEach(s=>{s!=="type"&&s!=="haveInstallConditions"&&s!=="fieldJobOrderId"&&s!=="fieldJobType__c"&&s!=="stage__c"&&s!=="name"&&(_[s]=""),s=="haveInstallConditions"&&(_[s]=!1),(s=="fileList"||s=="filePath")&&(_[s]=[])}),console.error("请求新增派工单失败:",e)}),G.value=!1,U.value=1},ea=t=>{Ce(t).then(e=>{let s=e.data;s.code=="success"&&s.data!=null?console.info("更新成功"):console.info("更新失败")})},ja=t=>{let e=Se.value.find(s=>s.optionCode==t);return t&&e?e.optionLabel:""},za=t=>{let e=Ie.value.find(s=>s.optionCode==t);return t&&e?e.optionLabel:""},Ha=t=>{let e=De.value.find(s=>s.optionCode==t);return t&&e?e.optionLabel:""},P=i({}),Wa=t=>{t!=null&&kl(t).then(e=>{let s=e.data;s.code=="success"?(P.value=s.data,_.fieldJobOrderId=s.data.id,_.fieldJobContactName=s.data.accountName__C,_.name=s.data.accountName__C+"的维修派工单",p.value.orderNo=P.value.po):C.$message.error(s==null?void 0:s.message)})},aa=t=>t.getTime()<Date.now()-24*60*60*1e3,Xa=()=>{if(n.value.caseStatus==4){C.$message.warning("当前服务工单已完成!");return}if(n.value.processingProcessAndResults==null||n.value.processingProcessAndResults==""){C.$message.warning("处理结论不能为空，请先编辑处理结论");return}let t={caseStatus:4,id:de.value,questionType:n.value.questionType,name:n.value.name};Ce(t).then(e=>{let s=e.data;s.code=="success"&&s.data!=null?(n.value.caseStatus=4,C.$message.success("服务工单完成")):C.$message.warning("服务工单完成失败,请重试")}).catch(e=>{C.$message.error("服务工单完成失败,系统异常"),console.log("服务工单完成状态更新:",e)})},Ga=t=>{Ae.value=fa.value[t],S.value.afterSalesIssues=[]},Ka=t=>{$.value.forEach(e=>{e.checked=t})},Qa=t=>{p.value.productType="",p.value.productType="",p.value.productModel="",p.value.treeSpecies="",p.value.paintColor="",p.value.size="",p.value.orderType="",j.value=$.value},Za=t=>{Z()},el=t=>{Z()},al=t=>{Z()},ll=t=>{Z()},tl=t=>{Z()},Z=()=>{j.value=$.value.filter(t=>{let e=!0;p.value.size!=""&&p.value.size!="1"&&(e=t.fscProductSpec==p.value.size);let s=!0;p.value.productType!=""&&p.value.productType!="1"&&(s=t.category1==p.value.productType);let d=!0;p.value.productModel!=""&&p.value.productModel!="1"&&(d=t.fscProductModel==p.value.productModel);let g=!0;p.value.treeSpecies!=""&&p.value.treeSpecies!="1"&&(g=t.treeSpecies__c==p.value.treeSpecies);let u=!0;return p.value.paintColor!=""&&p.value.paintColor!="1"&&(u=t.paintColor__c==p.value.paintColor),e&&d&&s&&g&&u}),console.log(j)},sl=()=>{C.$router.push("my_personnel")};return(t,e)=>{var la;const s=L("el-button"),d=L("el-checkbox"),g=L("el-input"),u=L("el-table-column"),I=L("el-table"),r=L("el-option"),f=L("el-select"),O=L("el-icon"),A=L("el-upload"),J=L("el-dialog"),F=L("el-form-item"),oe=L("el-date-picker"),ye=L("el-form"),ol=L("el-image");return v(),D("div",Nl,[a("span",Pl,[a("span",xl,[Ll,o(s,{class:"btn",onClick:Oa},{default:c(()=>[k("升级到总部 (售后)")]),_:1})]),a("span",Ul,[a("span",ql,[a("span",{class:V(n.value.caseStatus==1?"num_selected":"num")},"1",2),a("span",{class:V(n.value.caseStatus>=1?"name_selected":"name")},"待处理",2)]),a("span",$l,[a("span",{class:V(n.value.caseStatus==2?"num_selected":"num")},"2",2),a("span",{class:V(n.value.caseStatus>=2?"name_selected":"name")},"已受理",2)]),a("span",Ol,[a("span",{class:V(n.value.caseStatus==3?"num_selected":"num")},"3",2),a("span",{class:V(n.value.caseStatus>=3?"name_selected":"name")},"处理中",2)]),a("span",Al,[a("span",{onClick:Xa,class:V(n.value.caseStatus==4?"num_selected":"num")},"4",2),a("span",{class:V(n.value.caseStatus>=4?"name_selected":"name")},"已完成",2)])])]),a("span",Fl,[a("span",Ml,[k("问题提报详情"),a("span",Jl,h(b(te)<=2&&b(te)>0?$a(b(re)):""),1)]),a("span",Rl,[a("span",El,[a("span",Bl,[Yl,a("span",jl,h(n.value.caseNo),1),E("",!0)]),a("span",zl,[Hl,a("span",Wl,h(n.value.storeName),1)]),a("span",Xl,[Gl,a("span",Kl,h(n.value.questionType=="1"?"售后保修":"投诉建议"),1)])]),a("span",Ql,[a("span",Zl,[et,a("span",at,h(P.value.po),1)]),a("span",lt,[tt,a("span",st,h(n.value.followerName),1)]),a("span",ot,[nt,a("span",dt,h(n.value.createdTime),1)])]),a("span",ct,[a("span",rt,[it,a("span",ut,h(n.value.problemDescription),1)]),a("span",pt,[mt,a("span",vt,h(n.value.complaintSourceC?(la=ha.value.find(l=>l.code==n.value.complaintSourceC))==null?void 0:la.name:""),1)]),a("span",_t,[ft,a("span",ht,h(n.value.externalUserName),1)])]),a("span",bt,[a("span",gt,[yt,a("span",kt,h(n.value.externalUserPhone),1)]),a("span",Ct,[wt,a("span",Tt,h(n.value.purchaseStoreName),1)])])]),St,a("span",It,[a("span",Dt,[a("span",Vt,[Nt,a("span",Pt,h(n.value.customerName),1)]),a("span",xt,[Lt,a("span",Ut,h(n.value.phone),1)]),a("span",qt,[$t,a("span",Ot,h(n.value.processingProcessAndResults),1)])]),a("span",At,[a("span",Ft,[Mt,a("span",Jt,h(ja(n.value.province)),1)]),a("span",Rt,[Et,a("span",Bt,h(za(n.value.city)),1)]),a("span",Yt,[jt,a("span",zt,h(Ha(n.value.district)),1)])]),a("span",Ht,[a("span",Wt,[Xt,o(d,{modelValue:ce.value,"onUpdate:modelValue":e[0]||(e[0]=l=>ce.value=l),disabled:""},null,8,["modelValue"])])])])]),a("span",Gt,[Kt,o(s,{class:"btn"},{default:c(()=>[k(h(se.value.length)+"个售后工单",1)]),_:1}),o(s,{class:"btn"},{default:c(()=>[k(h(me.value.length)+"个派工单",1)]),_:1}),o(s,{class:"btn"},{default:c(()=>[k(h(ue.value.length)+"个附件",1)]),_:1}),a("span",{class:"view",onClick:Ba},"点击查看")]),a("span",Qt,[a("div",{class:"left"},[Zt,a("span",{class:"initiate_comments",onClick:Ma},"发起评论")]),a("div",es,[o(s,{type:"primary",onClick:Ja,class:"primary_btn"},{default:c(()=>[k("编辑")]),_:1}),o(s,{type:"primary",onClick:Ta,class:"primary_btn"},{default:c(()=>[k("创建派工单")]),_:1})])]),(v(!0),D(N,null,x(da.value,l=>(v(),D("div",{class:"comment",key:l.date},[a("div",as,[ls,a("span",ts,h(l.userName),1)]),a("div",ss,h(l.text),1),a("div",os,h(l.date),1),ns,ds]))),128)),a("div",cs,[o(J,{modelValue:H.value,"onUpdate:modelValue":e[20]||(e[20]=l=>H.value=l),title:"升级到总部 (售后)",width:"80% ","show-close":!1},{footer:c(()=>[a("div",Js,[o(s,{class:"cancel_btn",onClick:e[19]||(e[19]=l=>H.value=!1)},{default:c(()=>[k("取消")]),_:1}),M.value==1?(v(),w(s,{key:0,onClick:Aa,type:"primary",class:"primary_btn",style:{"margin-left":"50px !important"}},{default:c(()=>[k("下一步")]),_:1})):E("",!0),M.value==2?(v(),w(s,{key:1,onClick:Fa,type:"primary",class:"primary_btn",style:{"margin-left":"50px !important"}},{default:c(()=>[k("提交")]),_:1})):E("",!0)])]),default:c(()=>[a("div",rs,[a("span",is,[a("span",{onClick:e[1]||(e[1]=l=>fe(1)),class:V(M.value==1?"num_selected":"num")},"1",2),us]),a("span",ps,[a("span",{onClick:e[2]||(e[2]=l=>fe(2)),class:V(M.value==2?"num_selected":"num")},"2",2),ms]),a("span",vs,[a("span",{onClick:e[3]||(e[3]=l=>fe(3)),class:V(M.value==3?"num_selected":"num")},"3",2),_s])]),M.value==1?(v(),D(N,{key:0},[a("span",fs,[hs,o(g,{disabled:"",modelValue:p.value.orderNo,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value.orderNo=l),placeholder:"订单编号",style:{width:"auto"}},null,8,["modelValue"])]),a("div",bs,[gs,o(g,{modelValue:p.value.remark,"onUpdate:modelValue":e[5]||(e[5]=l=>p.value.remark=l),placeholder:"输入升级描述",style:{width:"auto"}},null,8,["modelValue"])]),ys,a("div",ks,[o(I,{ref_key:"multipleTableRef",ref:Ue,"selection-change":qe,data:K.value,stripe:!1,style:{width:"100%",overflow:"auto"},"max-height":"400"},{default:c(()=>[o(u,{prop:"checked",label:"全选",width:"80px"},{default:c(l=>[l.row.operate==!1?(v(),w(d,{key:0,disabled:"",modelValue:l.row.checked,"onUpdate:modelValue":y=>l.row.checked=y},null,8,["modelValue","onUpdate:modelValue"])):E("",!0),l.row.operate==!0?(v(),w(d,{key:1,modelValue:l.row.checked,"onUpdate:modelValue":y=>l.row.checked=y},null,8,["modelValue","onUpdate:modelValue"])):E("",!0)]),_:1}),o(u,{prop:"name",label:"售后工单编号"},{default:c(l=>[a("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:y=>Ze(l.row)},h(l.row.name),9,Cs)]),_:1}),o(u,{prop:"distributorNo",label:"经销商名称"}),o(u,{prop:"storeName",label:"专卖店名称"}),o(u,{prop:"status__c",label:"状态"},{default:c(l=>{var y;return[a("div",ws,h(l.row.status__c?(y=Fe.value.find(R=>R.code==l.row.status__c))==null?void 0:y.name:""),1)]}),_:1}),o(u,{prop:"reporter__c",label:"提报人"}),o(u,{prop:"problemDescription__c",label:"问题描述 "}),o(u,{prop:"distributorDemands__c",label:"经销商需求描述 "}),o(u,{prop:"createdTime",label:"创建时间 "}),o(u,{prop:"operate",label:"操作"},{default:c(l=>[l.row.operate?(v(),w(d,{key:0,disabled:"",modelValue:l.row.operate,"onUpdate:modelValue":y=>l.row.operate=y,value:l.row.operate,style:{"--el-disabled-text-color":"#ff8127","--el-checkbox-disabled-checked-icon-color":"white","--el-checkbox-disabled-checked-input-fill":"#ff8127","--el-checkbox-text-color":"#ff8127"}},{default:c(()=>[k("已绑定")]),_:2},1032,["modelValue","onUpdate:modelValue","value"])):(v(),D("div",{key:1,style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:y=>he(l.row,!1)}," 点击绑定 ",8,Ts))]),_:1})]),_:1},8,["data"])])],64)):E("",!0),M.value==2?(v(),D(N,{key:1},[a("div",Ss,[Is,a("span",Ds,[o(s,{style:{display:"none"},class:"btn",onClick:e[6]||(e[6]=l=>He(1))},{default:c(()=>[k("完善问题描述")]),_:1}),o(s,{style:{display:"none"},class:"btn",onClick:e[7]||(e[7]=l=>He(2))},{default:c(()=>[k("定义处理方式")]),_:1})])]),a("div",Vs,[o(f,{modelValue:p.value.orderType,"onUpdate:modelValue":e[8]||(e[8]=l=>p.value.orderType=l),placeholder:"清除筛选",onChange:Qa},{default:c(()=>[(v(!0),D(N,null,x(pa.value,l=>(v(),w(r,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(f,{modelValue:p.value.productType,"onUpdate:modelValue":e[9]||(e[9]=l=>p.value.productType=l),placeholder:"产品大类",onChange:Za},{default:c(()=>[(v(!0),D(N,null,x(Ve.value,l=>(v(),w(r,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(f,{modelValue:p.value.productModel,"onUpdate:modelValue":e[10]||(e[10]=l=>p.value.productModel=l),placeholder:"产品型号",onChange:el},{default:c(()=>[(v(!0),D(N,null,x(Ne.value,l=>(v(),w(r,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(f,{modelValue:p.value.treeSpecies,"onUpdate:modelValue":e[11]||(e[11]=l=>p.value.treeSpecies=l),placeholder:"树种",onChange:al},{default:c(()=>[(v(!0),D(N,null,x(Pe.value,l=>(v(),w(r,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(f,{modelValue:p.value.paintColor,"onUpdate:modelValue":e[12]||(e[12]=l=>p.value.paintColor=l),placeholder:"油漆颜色",onChange:ll},{default:c(()=>[(v(!0),D(N,null,x(xe.value,l=>(v(),w(r,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(f,{modelValue:p.value.size,"onUpdate:modelValue":e[13]||(e[13]=l=>p.value.size=l),placeholder:"尺寸",onChange:tl},{default:c(()=>[(v(!0),D(N,null,x(Le.value,l=>(v(),w(r,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a("div",Ns,[o(I,{ref_key:"multipleTableRef",ref:Ue,"selection-change":qe,data:j.value,stripe:!1,style:{width:"100%",overflow:"auto"},"max-height":"200"},{default:c(()=>[o(u,{prop:"checked",label:"全选",width:"80px"},{header:c(()=>[o(d,{onChange:Ka},{default:c(()=>[k("全选")]),_:1})]),default:c(l=>[o(d,{modelValue:l.row.checked,"onUpdate:modelValue":y=>l.row.checked=y},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(u,{prop:"orderPo",label:"订单编号"}),o(u,{prop:"sku",label:"详单编号"}),o(u,{prop:"category1",label:"产品大类"}),o(u,{prop:"fscProductModel",label:"产品型号"}),o(u,{prop:"treeSpecies__c",label:"树种"}),o(u,{prop:"paintColor__c",label:"油漆颜色 "}),o(u,{prop:"fscProductSpec",label:"尺寸 "}),o(u,{prop:"note",label:"售后回复 "}),o(u,{prop:"ticketClassification",label:"问题大类"},{default:c(l=>{var y;return[a("div",Ps,h(l.row.ticketClassification?(y=$e.value.find(R=>R.code==l.row.ticketClassification))==null?void 0:y.name:""),1)]}),_:1}),o(u,{prop:"ticketProblem",label:"售后问题 "}),o(u,{prop:"",label:"责任人 "}),o(u,{prop:"descriptionOfTicketProblem",label:"问题描述 "})]),_:1},8,["data"])]),a("div",xs,[Ls,o(f,{modelValue:S.value.problemType,"onUpdate:modelValue":e[14]||(e[14]=l=>S.value.problemType=l),placeholder:"",onChange:Ga},{default:c(()=>[(v(!0),D(N,null,x($e.value,l=>(v(),w(r,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Us,o(f,{multiple:"","collapse-tags":"",modelValue:S.value.afterSalesIssues,"onUpdate:modelValue":e[15]||(e[15]=l=>S.value.afterSalesIssues=l),placeholder:""},{default:c(()=>[(v(!0),D(N,null,x(Ae.value,l=>(v(),w(r,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),qs,o(g,{modelValue:S.value.responsiblePerson,"onUpdate:modelValue":e[16]||(e[16]=l=>S.value.responsiblePerson=l),style:{width:"240px"},placeholder:"请输入责任人"},null,8,["modelValue"])]),a("div",$s,[Os,o(g,{modelValue:S.value.problemDesc,"onUpdate:modelValue":e[17]||(e[17]=l=>S.value.problemDesc=l),style:{width:"440px"},rows:2,type:"textarea",placeholder:"请输入问题描述"},null,8,["modelValue"])]),As,a("div",Fs,[a("span",Ms,[o(A,{"on-success":ma,"on-remove":va,"auto-upload":!0,data:Je.value,headers:Ee.value,"before-upload":Sa,"list-type":"picture-card",class:"avatar-uploader",action:"https://sh.mengtian.com.cn:9595/md/api/common/file/upload","show-file-list":!0,"file-list":S.value.fileList,"onUpdate:fileList":e[18]||(e[18]=l=>S.value.fileList=l)},{default:c(()=>[o(O,null,{default:c(()=>[o(b(ta))]),_:1})]),_:1},8,["data","headers","file-list"])])])],64)):E("",!0)]),_:1},8,["modelValue"])]),a("div",Rs,[o(J,{modelValue:G.value,"onUpdate:modelValue":e[33]||(e[33]=l=>G.value=l),title:"新建配送派工单",width:"80%","show-close":!1},{footer:c(()=>[a("div",Qs,[o(s,{class:"cancel_btn",onClick:e[32]||(e[32]=l=>G.value=!1)},{default:c(()=>[k("取消")]),_:1}),U.value==1?(v(),w(s,{key:0,type:"primary",class:"primary_btn",onClick:Da},{default:c(()=>[k("下一步")]),_:1})):E("",!0),U.value==2?(v(),w(s,{key:1,type:"primary",class:"primary_btn",onClick:Ya},{default:c(()=>[k("完成")]),_:1})):E("",!0)])]),default:c(()=>[a("div",Es,[a("span",Bs,[a("span",{onClick:e[21]||(e[21]=l=>_e(1)),class:V(U.value==1?"num_selected":"num")},"1",2),a("span",{class:V(U.value>=1?"name_selected":"name")},[k("选择维修工程师 "),Ys],2)]),a("span",js,[a("span",{onClick:e[22]||(e[22]=l=>_e(2)),class:V(U.value==2?"num_selected":"num")},"2",2),a("span",{class:V(U.value>=2?"name_selected":"name")},[k("输入派工单注意事项 "),zs],2)]),a("span",Hs,[a("span",{onClick:e[23]||(e[23]=l=>_e(3)),class:V(U.value==3?"num_selected":"num")},"3",2),a("span",{class:V(U.value>=3?"name_selected":"name")},[k("完成创建 "),Ws],2)])]),a("div",Xs,[U.value==1?(v(),w(ye,{key:0,model:b(_),rules:Re,ref:"deliveryOrderFormRef","label-width":"90px","label-position":"left"},{default:c(()=>[o(F,{label:"人员名称",prop:"followerId"},{default:c(()=>[o(f,{modelValue:b(_).followerId,"onUpdate:modelValue":e[24]||(e[24]=l=>b(_).followerId=l),onChange:La,placeholder:"查找或输入服务人员姓名"},{default:c(()=>[(v(!0),D(N,null,x(X.value,l=>(v(),w(r,{key:l.name,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),a("span",{class:"custom_item",onClick:sl},Ks)]),_:1}),o(F,{label:"联系方式",prop:"contactTelephone"},{default:c(()=>[o(g,{modelValue:b(_).contactTelephone,"onUpdate:modelValue":e[25]||(e[25]=l=>b(_).contactTelephone=l),placeholder:"查找或输入服务人员手机号码"},null,8,["modelValue"])]),_:1}),o(F,{label:"预约开始",prop:"appointmentStartTime"},{default:c(()=>[o(oe,{modelValue:b(_).appointmentStartTime,"onUpdate:modelValue":e[26]||(e[26]=l=>b(_).appointmentStartTime=l),type:"datetime",placeholder:"日期/时间","value-format":"YYYY-MM-DD HH:mm:ss","default-time":b(we),"disabled-date":aa},null,8,["modelValue","default-time"])]),_:1}),o(F,{label:"预约结束",prop:"appointmentEndTime"},{default:c(()=>[o(oe,{modelValue:b(_).appointmentEndTime,"onUpdate:modelValue":e[27]||(e[27]=l=>b(_).appointmentEndTime=l),type:"datetime",placeholder:"日期/时间","value-format":"YYYY-MM-DD HH:mm:ss","default-time":b(we),"disabled-date":aa},null,8,["modelValue","default-time"])]),_:1})]),_:1},8,["model","rules"])):E("",!0),U.value==2?(v(),w(ye,{key:1,model:b(_),rules:Re,ref:"deliveryOrderFormRef","label-width":"90px","label-position":"left"},{default:c(()=>[o(F,{label:"优先级",prop:"priority"},{default:c(()=>[o(f,{modelValue:b(_).priority,"onUpdate:modelValue":e[28]||(e[28]=l=>b(_).priority=l),placeholder:"选择优先级"},{default:c(()=>[(v(!0),D(N,null,x(ga.value,l=>(v(),w(r,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(F,{label:"派工类型",prop:"fieldJobType__c"},{default:c(()=>[o(f,{modelValue:b(_).fieldJobType__c,"onUpdate:modelValue":e[29]||(e[29]=l=>b(_).fieldJobType__c=l),placeholder:"选择派工类型"},{default:c(()=>[(v(!0),D(N,null,x(ba.value,l=>(v(),w(r,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(F,{label:"派工单备注",class:"customLayout"},{default:c(()=>[o(g,{modelValue:b(_).remark,"onUpdate:modelValue":e[30]||(e[30]=l=>b(_).remark=l),rows:5,type:"textarea",maxlength:"500",placeholder:"请填写派工单备注","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(F,{label:"上传图片",class:"custom_upload"},{default:c(()=>[o(A,{"on-success":Na,"on-remove":Va,"auto-upload":!0,data:Me.value,headers:Ee.value,"before-upload":Ia,"file-list":b(_).fileList,"onUpdate:fileList":e[31]||(e[31]=l=>b(_).fileList=l),class:"avatar-uploader",action:"https://sh.mengtian.com.cn:9595/md/api/common/file/upload","show-file-list":!0,"list-type":"picture-card"},{default:c(()=>[o(O,{class:"avatar-uploader-icon"},{default:c(()=>[o(b(ta))]),_:1})]),_:1},8,["data","headers","file-list"])]),_:1})]),_:1},8,["model","rules"])):E("",!0)])]),_:1},8,["modelValue"])]),a("div",Zs,[o(J,{modelValue:le.value,"onUpdate:modelValue":e[37]||(e[37]=l=>le.value=l),title:"编辑",width:"40%","show-close":!1},{footer:c(()=>[a("div",ao,[o(s,{class:"cancel_btn",onClick:e[36]||(e[36]=l=>le.value=!1)},{default:c(()=>[k("取消")]),_:1}),o(s,{type:"primary",class:"primary_btn",onClick:Ua},{default:c(()=>[k("保存")]),_:1})])]),default:c(()=>[a("div",eo,[o(ye,{model:b(T),rules:Pa,ref:"deditFollowerAndPDescriptFormRef","label-width":"90px","label-position":"left"},{default:c(()=>[o(F,{label:"负责人",prop:"followerId"},{default:c(()=>[o(f,{modelValue:b(T).followerId,"onUpdate:modelValue":e[34]||(e[34]=l=>b(T).followerId=l),onChange:xa,placeholder:"请选择负责人"},{default:c(()=>[(v(!0),D(N,null,x(X.value,l=>(v(),w(r,{key:l.name,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(F,{label:"经销商处理结论",prop:"processingProcessAndResults"},{default:c(()=>[o(g,{type:"textarea",modelValue:b(T).processingProcessAndResults,"onUpdate:modelValue":e[35]||(e[35]=l=>b(T).processingProcessAndResults=l),placeholder:"请输入经销商处理结论"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])]),a("div",lo,[o(J,{modelValue:ae.value,"onUpdate:modelValue":e[39]||(e[39]=l=>ae.value=l),title:"相关单据",width:"80%","show-close":!1},{footer:c(()=>[a("div",go,[o(s,{type:"primary",class:"primary_btn",onClick:e[38]||(e[38]=l=>ae.value=!1)},{default:c(()=>[k("返回")]),_:1})])]),default:c(()=>[a("div",to,[a("span",so,[oo,a("span",no,[o(I,{data:se.value,stripe:!1,style:{width:"100%"}},{default:c(()=>[o(u,{prop:"name",label:"售后工单编号"}),o(u,{prop:"serviceTicketType__c",label:"类别"}),o(u,{prop:"text3",label:"负责人"}),o(u,{prop:"status__c",label:"状态"},{default:c(l=>{var y;return[a("div",co,h(l.row.status__c?(y=Fe.value.find(R=>R.code==l.row.status__c))==null?void 0:y.name:""),1)]}),_:1}),o(u,{prop:"updatedTime",label:"修改时间"}),o(u,{label:"操作",width:"80px"},{default:c(l=>[a("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:y=>Ze(l.row)}," 查看 ",8,ro)]),_:1})]),_:1},8,["data"])])]),a("span",io,[uo,a("span",po,[o(I,{data:me.value,stripe:!1,style:{width:"100%"}},{default:c(()=>[o(u,{prop:"caseNo",label:"派工单编号"}),o(u,{prop:"fieldJobType__c",label:"类别"},{default:c(l=>{var y;return[a("div",mo,h(l.row.fieldJobType__c?(y=ya.value.find(R=>R.code==l.row.fieldJobType__c))==null?void 0:y.name:"配送派工单"),1)]}),_:1}),o(u,{prop:"followerName",label:"负责人"}),o(u,{prop:"status",label:"状态"},{default:c(l=>{var y;return[a("div",vo,h(l.row.stage__c?(y=ka.value.find(R=>R.code==l.row.stage__c))==null?void 0:y.name:"待开始"),1)]}),_:1}),o(u,{prop:"updatedTime",label:"修改时间"}),o(u,{label:"操作",width:"80px"},{default:c(l=>[a("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:y=>Ea(l.row)}," 查看 ",8,_o)]),_:1})]),_:1},8,["data"])])]),a("span",fo,[ho,a("span",bo,[o(I,{data:ue.value,stripe:!1,style:{width:"100%"},"max-height":"150"},{default:c(()=>[o(u,{prop:"picNo",label:"附件编号"}),o(u,{prop:"type",label:"类型"}),o(u,{prop:"text3",label:"附件链接"},{default:c(({row:l})=>[(v(!0),D(N,null,x(l.picture,(y,R)=>(v(),w(ol,{key:R,style:{"margin-right":"5px",width:"50px"},src:y,"preview-src-list":l.picture},null,8,["src","preview-src-list"]))),128))]),_:1})]),_:1},8,["data"])])])])]),_:1},8,["modelValue"])])])}}}),Do=bl(yo,[["__scopeId","data-v-50463321"]]);export{Do as default};
