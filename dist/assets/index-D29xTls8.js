import{u as p}from"./userinfo-CCqg8oIg.js";import{w as f,a as m}from"./common-DUTHUj4v.js";import{d as h,g as _,r,o as w,c as x,a as I,_ as g}from"./index-u4ky4G3-.js";const v={class:"main"},k=h({__name:"index",setup(y){const{proxy:c}=_();p();const s=r(null),l=r(null),n=r({userId:"",corpId:"",token:""});w(()=>{const t=window.location.href.indexOf("?"),e=t>=0?window.location.href.substring(t+1):window.location.href,o=new URLSearchParams(e).get("code");o&&(alert("wxcode:"+o),l.value=o,u())});const u=async()=>new Promise(function(t){f({code:l.value,userType:2}).then(e=>{let a=e.data;if(a.code=="success"){let o=a.data||{};n.value=o,n.value.token?(localStorage.setItem("token",o.token),sessionStorage.setItem("token",o.token),c.$router.push({path:"/main",query:{}})):c.$prompt("请输入用户手机号","提示",{confirmButtonText:"确定",cancelButtonText:"取消",showCancelButton:!1,showClose:!1,inputPlaceholder:"请输入手机号",inputPattern:/^1[3456789]\d{9}$/,inputErrorMessage:"手机号格式不正确!"}).then(({value:i})=>{s.value=i,d()}).catch(()=>{})}t(!0)})}),d=async()=>{let t={phone:s.value,name:s.value,corpId:n.value.corpId,userId:n.value.userId,userType:2};alert("新增用户接口参数:"+JSON.stringify(t)),m(t).then(e=>{var a;alert(JSON.stringify(e.data)),((a=e==null?void 0:e.data)==null?void 0:a.code)=="success"?u():console.log("失败")}).catch(e=>{alert("新增失败!"),console.error("新增失败:",e)})};return(t,e)=>(I(),x("div",v," 验证 "))}}),C=g(k,[["__scopeId","data-v-bb507dfa"]]);export{C as default};
