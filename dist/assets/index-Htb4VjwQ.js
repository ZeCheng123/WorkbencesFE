import{_ as ue,a as de,b as me}from"./logoXX-KcEG4fMf.js";import{_ as pe}from"./plus-B8sn_dc4.js";import{_ as _e}from"./download-Dan4AgsM.js";import{d as fe,g as ve,r as d,a as he,o as ge,y as be,c as k,h as r,b as a,w as o,e as p,p as ye,f as Ne,i as x,F as z,m as L,s as E,j as N,t as R,v as q,u as Se,x as xe,_ as Ve}from"./index-BNw8j_YZ.js";import{h as Ce}from"./moment-Cl4UOzQZ.js";import{g as De,h as Pe,k as we,e as F}from"./common-DZytvcl-.js";import"./userinfo-CbCawm5q.js";const v=w=>(ye("data-v-c11632eb"),w=w(),Ne(),w),ke={class:"main"},Te=v(()=>r("span",{class:"header"},[r("span",{class:"title"},"问题提报")],-1)),Ue={class:"search"},Ie={class:"left"},$e=v(()=>r("span",{style:{width:"336px",height:"32px"}},null,-1)),ze={class:"right"},Le=v(()=>r("img",{src:de,alt:""},null,-1)),Ee=v(()=>r("img",{src:me,alt:""},null,-1)),Ye={class:"table_header"},He=v(()=>r("span",{class:"left"},[r("img",{src:ue,alt:""}),r("span",{class:"title"})],-1)),Me={class:"right"},Re=v(()=>r("img",{src:pe,alt:""},null,-1)),qe=v(()=>r("img",{src:_e,alt:""},null,-1)),Fe={style:{display:"flex","align-items":"center"}},Oe={style:{display:"flex","align-items":"center"}},Be=["onClick"],We={class:"problemReportingDialog"},Ae={class:"step"},je={class:"item"},Ge=v(()=>r("span",{class:"name"},[N("完善提报信息 "),r("span",{class:"remark"},"完善问题提报的信息")],-1)),Je={class:"item"},Ke=v(()=>r("span",{class:"name"},[N("完成创建 "),r("span",{class:"remark"},"等待售服部处理")],-1)),Qe={class:"content"},Xe={class:"dialog-footer"},Ze=fe({__name:"index",setup(w){const{proxy:h}=ve(),g=d({pageIndex:1,pageSize:15,total:0}),O=d({Content:"application/json",Authorization:"",isImage:"true",needFileId:"true","Trace-Id":""}),Y=d({files:[],name:"files"}),s=he({problemNo:"",customerName:"",customerPhone:"",filterMethod:"",createDate:[],tableData:[],orderStatus:""});d([{value:"all",label:"全部"}]),d([{value:"all",label:"全部"}]);const B=d([{name:"配送技工",code:"1"},{name:"安装技工",code:"2"},{name:"客户",code:"3"},{name:"经销商",code:"4"}]),H=d([{name:"全部",code:""},{name:"待处理",code:"1"},{name:"已受理",code:"2"},{name:"处理中",code:"3"},{name:"已完成",code:"4"}]),C=d(!1),M=d(1),c=d({orderNo:"",customerName:"",customerPhone:"",desc:"",fileList:[],filePath:[]}),W=d({customerName:[{required:!0,message:"客户姓名不能为空！",trigger:"blur"}],customerPhone:[{required:!0,message:"客户电话不能为空！",trigger:"blur"}],desc:[{required:!0,message:"问题描述不能为空！",trigger:"blur"}]}),T=d([]),U=d([]),I=d([]),D=d({}),S=d(null);ge(()=>{setTimeout(()=>{P(),K(),Q();const n="100%"/"100%";if(window.addEventListener("resize",be.debounce(function(){const l=document.body.clientHeight,i=document.body.clientWidth;if(i<1680){const b=l/i;let[_,f]=[0,0];if(b<n){_=l/1080;const m=1920*_,u=i-m;f=u>0?`translate(${u/2}px, 0)`:""}else{_=(i-20)/1920;const m=1080*_,u=l-m;f=u>0?`translate(0, ${u/2}px)`:""}if(b<.52){let m=document.body.clientHeight/_-242*_-10;S.value&&(S.value.style.height=`${m}px`)}else if(S.value){let m=document.body.clientHeight*_+242*_+10;S.value.style.height=`${m}px`}}else S.value&&(S.value.style.height=`calc(${document.body.clientHeight}px - 242px)`)},66)),document.createEvent){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!0),window.dispatchEvent(e)}else typeof Event=="function"&&window.dispatchEvent(new Event("resize"))},500)});const A=n=>{let e=n.id,l=n.neoid,i=n.caseStatus,b=n.createdTime,_=n.name,f=n.questionType,m="id="+e,u={};l!=null&&(m=m+"&neoid="+l,i===1&&b!=null&&(u={id:e,questionType:f||0,name:_,caseStatus:2,dealerAcceptanceTime:Ce().format("YYYY-MM-DD HH:mm:ss")},console.info("params",u)),j(u,m))},j=(n,e)=>{n.id!=null?F(n).then(l=>{let i=l.data;i.code=="success"&&i.data!=null?(h.$router.push(`/problem_report_details?${e}`),console.info("更新成功")):console.info("更新失败")}):h.$router.push(`/problem_report_details?${e}`)},G=()=>{C.value=!0},J=()=>{console.log("problemReportingForm",c.value);for(let e in c.value)if(e!="orderNo"&&e!="fileList"&&e!="filePath"&&c.value[e]==""){h.$message.error("必填字段不能为空!");return}let n={orderNeoId:c.value.orderNo,name:D.value.accountName__C+"的服务工单",externalUserName:c.value.customerName,externalUserPhone:c.value.customerPhone,problemDescription:c.value.desc,picture:c.value.filePath,caseStatus:"1",questionType:1,caseSource:11,clientCaseStatusC:1,complaintSourceC:4,phone:D.value.contactTel,customerName:D.value.accountName__C,address:D.value.customerAddress};F(n).then(e=>{let l=e.data;l.code=="success"?(c.value={orderNo:"",customerName:"",customerPhone:"",desc:"",fileList:[],filePath:[]},C.value=!1,h.$message.success("提交成功!"),P()):h.$message.error(l==null?void 0:l.message)})},P=()=>{let n={caseStatus:s.orderStatus==null?"":s.orderStatus,caseNo:s.problemNo==null?"":s.problemNo,accountName:s.customerName==null?"":s.customerName,accountPhone:s.customerPhone==null?"":s.customerPhone,from:s.createDate==null||s.createDate[0]==null?"":s.createDate[0]+" 00:00:00",to:s.createDate==null||s.createDate[1]==null?"":s.createDate[1]+" 23:59:59",pageSize:g.value.pageSize,pageNo:g.value.pageIndex};De(n).then(e=>{let l=e.data;l.code=="success"?(T.value=l.data,g.value={pageIndex:e.data.current==null?1:parseInt(e.data.current),pageSize:e.data.size,total:e.data.total}):(h.$message.error(l==null?void 0:l.message),T.value=[],g.value={pageIndex:1,pageSize:15,total:0})})},K=()=>{Pe({deliveryDate:"",status__c:"",orderType__c:"",transactionDate:"",po:"",accountName:"",accountPhone:""}).then(e=>{let l=e.data;l.code=="success"?U.value=l.data:h.$message.error(l==null?void 0:l.message)})},Q=()=>{we({userType:1,name:"",phone:""}).then(e=>{let l=e.data.data;l!=null&&l.length>0?I.value=l:h.$message.warning("未获取到人员数据")})},X=n=>{let e=I.value.find(l=>l.neoId==n);e&&(c.value.customerName=e.name,c.value.customerPhone=e.phone)},Z=n=>{let e=U.value.find(l=>l.neoid==n);e&&(D.value=e)},ee=n=>{if(console.log(n),n.code=="success"){let e=n.data.map(l=>l.fileId);c.value.filePath=c.value.filePath.concat(e),console.log(c.value.filePath)}},te=n=>{var e=n.response;console.log(e)},ae=n=>{Y.value.files=[n]},le=()=>{console.log("aaaa"),s.problemNo="",s.customerName="",s.customerPhone="",s.filterMethod="",s.createDate=[],s.orderStatus="",P()},oe=n=>{g.value.pageIndex=n,P()};return(n,e)=>{const l=p("el-input"),i=p("el-form-item"),b=p("el-form"),_=p("el-date-picker"),f=p("el-option"),m=p("el-select"),u=p("el-button"),y=p("el-table-column"),se=p("el-table"),ne=p("el-pagination"),re=p("el-icon"),ce=p("el-upload"),ie=p("el-dialog");return x(),k("div",ke,[Te,r("span",Ue,[r("span",Ie,[a(b,{model:s,"label-width":"80px","label-position":"left"},{default:o(()=>[a(i,{label:"问题编号"},{default:o(()=>[a(l,{placeholder:"请输入问题编号",modelValue:s.problemNo,"onUpdate:modelValue":e[0]||(e[0]=t=>s.problemNo=t)},null,8,["modelValue"])]),_:1}),a(i,{label:"客户名称"},{default:o(()=>[a(l,{placeholder:"输入客户名称",modelValue:s.customerName,"onUpdate:modelValue":e[1]||(e[1]=t=>s.customerName=t)},null,8,["modelValue"])]),_:1}),a(i,{label:"客户电话"},{default:o(()=>[a(l,{placeholder:"请输入客户电话",modelValue:s.customerPhone,"onUpdate:modelValue":e[2]||(e[2]=t=>s.customerPhone=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),a(b,{model:s,"label-width":"80px","label-position":"left"},{default:o(()=>[a(i,{label:"创建时间"},{default:o(()=>[a(_,{modelValue:s.createDate,"onUpdate:modelValue":e[3]||(e[3]=t=>s.createDate=t),type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),a(i,{label:"问题状态"},{default:o(()=>[a(m,{modelValue:s.orderStatus,"onUpdate:modelValue":e[4]||(e[4]=t=>s.orderStatus=t),placeholder:"请选择问题状态"},{default:o(()=>[(x(!0),k(z,null,L(H.value,t=>(x(),E(f,{key:t.code,label:t.name,value:t.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),$e]),_:1},8,["model"])]),r("span",ze,[a(u,{type:"primary",onClick:P,class:"search_btn"},{icon:o(()=>[Le]),default:o(()=>[N("查询")]),_:1}),a(u,{type:"primary",onClick:e[5]||(e[5]=t=>le()),class:"reset_btn"},{icon:o(()=>[Ee]),default:o(()=>[N("重置")]),_:1})])]),r("span",Ye,[He,r("span",Me,[a(u,{onClick:G,type:"primary",class:"search_btn"},{icon:o(()=>[Re]),default:o(()=>[N("新建")]),_:1}),a(u,{type:"primary",class:"reset_btn"},{icon:o(()=>[qe]),default:o(()=>[N("下载")]),_:1})])]),r("span",{class:"table",ref_key:"mainTable",ref:S},[a(se,{class:"table_content",data:T.value,stripe:!1,style:{width:"100%"}},{default:o(()=>[a(y,{prop:"caseNo",label:"问题编号"}),a(y,{prop:"name",label:"客户姓名"}),a(y,{prop:"problemDescription",label:"问题描述"}),a(y,{prop:"complaintSourceC",label:"来源"},{default:o(t=>{var V;return[r("div",Fe,R(t.row.complaintSourceC?(V=B.value.find($=>$.code==t.row.complaintSourceC))==null?void 0:V.name:""),1)]}),_:1}),a(y,{prop:"externalUserName",label:"提报人"}),a(y,{prop:"createdTime",label:"创建时间"}),a(y,{prop:"caseStatus",label:"问题状态"},{default:o(t=>{var V;return[r("div",Oe,R(t.row.caseStatus?(V=H.value.find($=>$.code==t.row.caseStatus))==null?void 0:V.name:""),1)]}),_:1}),a(y,{prop:"",label:"操作",width:"80px"},{default:o(t=>[r("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:V=>A(t.row)}," 查看 ",8,Be)]),_:1})]),_:1},8,["data"]),a(ne,{class:"table_pagination","page-size":g.value.pageSize,"pager-count":g.value.pageSize,layout:"total, prev, pager, next",total:g.value.total,onCurrentChange:oe},null,8,["page-size","pager-count","total"])],512),r("div",We,[a(ie,{modelValue:C.value,"onUpdate:modelValue":e[12]||(e[12]=t=>C.value=t),title:"问题提报",width:"80%","show-close":!1},{footer:o(()=>[r("div",Xe,[a(u,{class:"cancel_btn",onClick:e[11]||(e[11]=t=>C.value=!1)},{default:o(()=>[N("取消")]),_:1}),a(u,{type:"primary",class:"primary_btn",onClick:J},{default:o(()=>[N("提交")]),_:1})])]),default:o(()=>[r("span",Ae,[r("span",je,[r("span",{class:q(M.value==1?"num_selected":"num")},"1",2),Ge]),r("span",Je,[r("span",{class:q(M.value==2?"num_selected":"num")},"2",2),Ke])]),r("div",Qe,[a(b,{model:c.value,rules:W.value,"label-width":"90px","label-position":"left"},{default:o(()=>[a(i,{label:"订单编号",prop:"orderNo"},{default:o(()=>[a(m,{modelValue:c.value.orderNo,"onUpdate:modelValue":e[6]||(e[6]=t=>c.value.orderNo=t),filterable:"",onChange:Z,placeholder:"请选择订单编号"},{default:o(()=>[(x(!0),k(z,null,L(U.value,t=>(x(),E(f,{key:t.po,label:t.po,value:t.neoid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"提报人姓名",prop:"customerName"},{default:o(()=>[a(m,{modelValue:c.value.customerName,"onUpdate:modelValue":e[7]||(e[7]=t=>c.value.customerName=t),onChange:X,placeholder:"请选择提报人人员"},{default:o(()=>[(x(!0),k(z,null,L(I.value,t=>(x(),E(f,{key:t.name,label:t.name,value:t.neoId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(i,{label:"提报人电话",prop:"customerPhone"},{default:o(()=>[a(l,{placeholder:"请输入提报人电话",modelValue:c.value.customerPhone,"onUpdate:modelValue":e[8]||(e[8]=t=>c.value.customerPhone=t)},null,8,["modelValue"])]),_:1}),a(i,{label:"问题描述",class:"customLayout",prop:"desc"},{default:o(()=>[a(l,{modelValue:c.value.desc,"onUpdate:modelValue":e[9]||(e[9]=t=>c.value.desc=t),rows:5,type:"textarea",maxlength:"500",placeholder:"请输入问题描述","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(i,{label:"上传图片",class:"custom_upload"},{default:o(()=>[a(ce,{"on-success":ee,"on-remove":te,"auto-upload":!0,data:Y.value,headers:O.value,"before-upload":ae,"list-type":"picture-card",class:"avatar-uploader",action:"https://sh.mengtian.com.cn:9595/md/api/common/file/upload","show-file-list":!0,"file-list":c.value.fileList,"onUpdate:fileList":e[10]||(e[10]=t=>c.value.fileList=t)},{default:o(()=>[a(re,null,{default:o(()=>[a(Se(xe))]),_:1})]),_:1},8,["data","headers","file-list"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])])])}}}),rt=Ve(Ze,[["__scopeId","data-v-c11632eb"]]);export{rt as default};
