import{_ as ol,a as nl,b as dl}from"./tips-DfmWQaVF.js";import{_ as cl}from"./add-CRTT_dyr.js";import{d as rl,g as il,r,H as ul,a as ne,k as pl,Q as ml,$ as ta,a0 as ke,a1 as sa,G as B,K as vl,V as _l,c as D,b as a,e as o,w as d,D as P,i as y,t as h,y as f,C as R,F as x,x as O,L as fl,A as Ce,f as $,p as hl,h as bl,o as v,B as w,E as oa,M as gl,X as yl,a2 as kl,T as Cl,a3 as Tl,O as wl,J as Sl,U as Il,_ as Vl}from"./index-1-lRGkZt.js";import{h as na}from"./moment-Cl4UOzQZ.js";const m=ee=>(hl("data-v-b349d084"),ee=ee(),bl(),ee),Dl={class:"main"},Nl={class:"header"},Pl={class:"title"},xl=m(()=>a("span",null,"问题提报状态",-1)),Ll={class:"step"},Ul={class:"item"},Ol={class:"item"},$l={class:"item"},ql={class:"item"},Fl={class:"problem_report_info"},Al={class:"title"},Ml={class:"titleDateTime"},El={class:"main_field"},Jl={class:"row_field"},Rl={class:"field"},Bl=m(()=>a("span",{class:"label"},"问题编号：",-1)),Yl={class:"value"},jl={class:"field"},zl=m(()=>a("span",{class:"label"},"专卖店名称：",-1)),Hl={class:"value"},Wl={class:"field"},Xl=m(()=>a("span",{class:"label"},"问题类别：",-1)),Gl={class:"value"},Kl={class:"row_field"},Ql={class:"field"},Zl=m(()=>a("span",{class:"label"},"订单编号：",-1)),et={class:"value"},at={class:"field"},lt=m(()=>a("span",{class:"label"},"负责人：",-1)),tt={class:"value"},st={class:"field"},ot=m(()=>a("span",{class:"label"},"创建时间：",-1)),nt={class:"value"},dt={class:"row_field"},ct={class:"field"},rt=m(()=>a("span",{class:"label"},"问题描述：",-1)),it={class:"value"},ut={class:"field"},pt=m(()=>a("span",{class:"label"},"来源：",-1)),mt={class:"value"},vt={class:"field"},_t=m(()=>a("span",{class:"label"},"提报人：",-1)),ft={class:"value"},ht={class:"row_field"},bt={class:"field"},gt=m(()=>a("span",{class:"label"},"提报人电话：",-1)),yt={class:"value"},kt=m(()=>a("span",{class:"title"},"其他字段",-1)),Ct={class:"other_field"},Tt={class:"row_field"},wt={class:"field"},St=m(()=>a("span",{class:"label"},"客户姓名：",-1)),It={class:"value"},Vt={class:"field"},Dt=m(()=>a("span",{class:"label"},"客户手机号：",-1)),Nt={class:"value"},Pt={class:"field"},xt=m(()=>a("span",{class:"label"},"经销商处理结论：",-1)),Lt={class:"value"},Ut={class:"row_field"},Ot={class:"field"},$t=m(()=>a("span",{class:"label"},"省份：",-1)),qt={class:"value"},Ft={class:"field"},At=m(()=>a("span",{class:"label"},"城市：",-1)),Mt={class:"value"},Et={class:"field"},Jt=m(()=>a("span",{class:"label"},"区：",-1)),Rt={class:"value"},Bt={class:"row_field"},Yt={class:"field"},jt=m(()=>a("span",{class:"label"},"经销商内部提报：",-1)),zt={class:"related_documents"},Ht=m(()=>a("span",{class:"title"},"相关单据",-1)),Wt={class:"action_list"},Xt=m(()=>a("img",{src:ol,alt:""},null,-1)),Gt={class:"right"},Kt={class:"userinfo"},Qt=m(()=>a("img",{src:nl,alt:""},null,-1)),Zt={class:"username"},es={class:"content"},as={class:"date"},ls=m(()=>a("span",{class:"reply"},"回复",-1)),ts=m(()=>a("img",{class:"tips",src:dl,alt:""},null,-1)),ss={class:"showMainDialog"},os={class:"step"},ns={class:"item"},ds=m(()=>a("span",{class:"name"},[y("确认问题订单 "),a("span",{class:"remark"},"选择或确认问题订单")],-1)),cs={class:"item"},rs=m(()=>a("span",{class:"name"},[y("完善必填信息 "),a("span",{class:"remark"},"完善问题描述与处理方式")],-1)),is={class:"item"},us=m(()=>a("span",{class:"name"},[y("提交升级 "),a("span",{class:"remark"},"提交售后至总部")],-1)),ps={class:"form_row_shengji"},ms=m(()=>a("span",{class:"label required"},"订单编号:",-1)),vs={class:"form_row_shengji"},_s=m(()=>a("span",{class:"label required"},"经销商需求描述:",-1)),fs=m(()=>a("div",{class:"search"},[a("span",{class:"label required"},"客户历史售后工单")],-1)),hs={class:"table"},bs=["onClick"],gs={style:{display:"flex","align-items":"center"}},ys=["onClick"],ks={class:"desc_action"},Cs=m(()=>a("span",{class:"desc"},"搜索和选择/批量编辑问题产品",-1)),Ts={class:"action"},ws={class:"filter_list"},Ss={class:"table"},Is={style:{display:"flex","align-items":"center"}},Vs={class:"responsibilityPerson"},Ds=m(()=>a("span",{class:"label required"},"问题大类",-1)),Ns=m(()=>a("span",{class:"label required"},"售后问题",-1)),Ps=m(()=>a("span",{class:"label required"},"责任人",-1)),xs={class:"responsibilityPerson"},Ls=m(()=>a("span",{class:"label required"},"问题描述",-1)),Us=m(()=>a("div",{class:"responsibilityPerson"},[a("span",{class:"label"},"上传文件")],-1)),Os={class:"containerUpload"},$s={class:"item"},qs={class:"dialog-footer"},Fs={class:"deliveryOrderDialog"},As={class:"step"},Ms={class:"item"},Es=m(()=>a("span",{class:"remark"},"选择配送货品的司机",-1)),Js={class:"item"},Rs=m(()=>a("span",{class:"remark"},"如有,请填写关键备注",-1)),Bs={class:"item"},Ys=m(()=>a("span",{class:"remark"},"等待司机配送",-1)),js={class:"content"},zs=m(()=>a("span",{class:"custom_item"},[a("img",{src:cl,alt:""})],-1)),Hs={class:"dialog-footer"},Ws={class:"editcontentDialog"},Xs={class:"content"},Gs={class:"dialog-footer"},Ks={class:"relatedDocumentsDialog"},Qs={class:"content"},Zs={class:"tableItem"},eo=m(()=>a("span",{class:"tableTitle"}," 1. 售后工单 ",-1)),ao={class:"tableContent"},lo={style:{display:"flex","align-items":"center"}},to=["onClick"],so={class:"tableItem"},oo=m(()=>a("span",{class:"tableTitle"}," 2. 派工单 ",-1)),no={class:"tableContent"},co={style:{display:"flex","align-items":"center"}},ro={style:{display:"flex","align-items":"center",color:"blue"}},io=["onClick"],uo={class:"tableItem"},po=m(()=>a("span",{class:"tableTitle"}," 3. 问题提报附件 ",-1)),mo={class:"tableContent"},vo={class:"dialog-footer"},_o=rl({__name:"index",setup(ee){const{proxy:C}=il(),Te=new Date,da=r([]),q=r(1),F=ul(),de=r(F.query.id),H=r(F.query.neoid);let we=null;const ca=F.query.status!=null?parseInt(F.query.status.toString(),0)+1:1,ae=r(!1),ra=r([]),W=r([]),ia=r([]),X=r(!1),ua=r(!1),le=r(!1),L=r([]),G=r([]),K=r([]);r([]);const c=r({}),Se=r([]),Ie=r([]),Ve=r([]),ce=r(!1);let Q="",re=r(),te=0,ie="";const ue=r([]);let pe=null;const p=r({orderNo:"",remark:"",searchValue:"",orderType:"",productType:"",productModel:"",treeSpecies:"",paintColor:"",size:""}),I=r({serviceTicketId:0,problemType:"",afterSalesIssues:[],responsiblePerson:"",problemDesc:"",fileList:[],filePath:[],poductType:"",componentType:"",badType:"",qualityIndicator1:"",qualityIndicator2:"",handleWay:""}),pa=r([{label:"清除",value:"1"}]),De=r([{label:"全部产品大类",value:"1"}]),Ne=r([{label:"全部产品型号",value:"1"}]),Pe=r([{label:"全部树种",value:"1"}]),xe=r([{label:"全部油漆颜色",value:"1"}]),Le=r([{label:"全部尺寸",value:"1"}]),j=r([]),ma=t=>{console.log(t),t.code=="success"&&(j.value=j.value.concat(t.data.map(e=>e.fileId)))},va=t=>{var e=t.response;if(e.code=="success"){const s=e.data[0].fileId,n=j.value.findIndex(k=>k===s);n!==-1&&j.value.splice(n,1)}},Ue=r(),_a=r([]),Oe=t=>{console.info("选择的数据：",t),_a.value=t};r([]),r([{text1:"SU2024030101",text2:"已评价",text3:"其他",text4:"满意",text5:"2021-02-28 10:30:50",text6:""}]);const $e=r([{code:"1",name:"经销商问题"},{code:"2",name:"公司问题"},{code:"3",name:"物流问题"}]),qe=r([{code:"1",name:"店面测量师漏单"},{code:"2",name:"店面测量师量错"},{code:"3",name:"店里设计师漏分解"},{code:"4",name:"店里设计师分解错"},{code:"5",name:"店里设计不合理"},{code:"6",name:"店里下单员漏单"},{code:"7",name:"店里下单员下错"},{code:"8",name:"店里安装师问题"},{code:"9",name:"消费者补单"},{code:"10",name:"消费者使用不当"},{code:"11",name:"产品丢失"},{code:"12",name:"公司问题"},{code:"13",name:"物流问题"}]),Fe=r([]),fa=r({1:[{code:"1",name:"店面测量师漏单"},{code:"2",name:"店面测量师量错"},{code:"3",name:"店里设计师漏分解"},{code:"4",name:"店里设计师分解错"},{code:"5",name:"店里设计不合理"},{code:"6",name:"店里下单员漏单"},{code:"7",name:"店里下单员下错"},{code:"8",name:"店里安装师问题"},{code:"9",name:"消费者补单"},{code:"10",name:"消费者使用不当"},{code:"11",name:"产品丢失"}],2:[{code:"12",name:"公司问题"}],3:[{code:"13",name:"物流问题"}]});r([{code:"1",name:"墙板"},{code:"2",name:"线条"},{code:"3",name:"五金"},{code:"4",name:"门套"},{code:"5",name:"门扇"},{code:"6",name:"柜体"},{code:"7",name:"柜门"},{code:"8",name:"玻璃"},{code:"9",name:"挂板"},{code:"10",name:"罗马柱"},{code:"11",name:"帽头"},{code:"12",name:"装饰块"},{code:"13",name:"雕花件"},{code:"14",name:"色板"},{code:"15",name:"整单"},{code:"16",name:"入户门"}]),r([{code:"1",name:"边梃"},{code:"2",name:"挂线条"},{code:"3",name:"芯板"},{code:"4",name:"金属条"},{code:"5",name:"码头"},{code:"6",name:"封边"},{code:"7",name:"L边"},{code:"8",name:"整体"},{code:"9",name:"面板执手"},{code:"10",name:"锁体"},{code:"11",name:"铰链"},{code:"12",name:"铰链底座"},{code:"13",name:"灯带"},{code:"14",name:"抽屉轨道"},{code:"15",name:"三合一"},{code:"16",name:"其他五金"},{code:"17",name:"档条"},{code:"18",name:"密封条"},{code:"19",name:"套板"},{code:"20",name:"门套"},{code:"21",name:"玻璃"},{code:"22",name:"门标"},{code:"23",name:"门芯板"},{code:"24",name:"配件"},{code:"25",name:"五金配件"},{code:"26",name:"8属边"},{code:"27",name:"背板"},{code:"28",name:"层板"},{code:"29",name:"抽屉板"},{code:"30",name:"底板"},{code:"31",name:"顶板"},{code:"32",name:"台面板"},{code:"33",name:"立板"},{code:"34",name:"侧板"},{code:"35",name:"踢脚板"},{code:"36",name:"五金件"},{code:"37",name:"挂板"},{code:"38",name:"罗马柱"},{code:"39",name:"帽头"},{code:"40",name:"装饰块"},{code:"41",name:"雕花件"},{code:"42",name:"色板"},{code:"43",name:"整单"},{code:"44",name:"修补漆"},{code:"45",name:"入户门扇"}]),r([{code:"1",name:"消费者"},{code:"2",name:"经销商"},{code:"3",name:"订单分解"},{code:"4",name:"备料"},{code:"5",name:"加工"},{code:"6",name:"免漆加工"},{code:"7",name:"油漆"},{code:"8",name:"少货"},{code:"9",name:"包装问题"},{code:"10",name:"五金问题"},{code:"11",name:"辅料问题"},{code:"12",name:"仓库发货"},{code:"13",name:"物流送达"},{code:"14",name:"系统问题"},{code:"15",name:"新品设计问题"},{code:"16",name:"隔音等级"},{code:"17",name:"受潮"},{code:"18",name:"无法提供证明的少货"},{code:"19",name:"交期延误"},{code:"20",name:"霉变"},{code:"21",name:"气味"},{code:"22",name:"长虫"},{code:"23",name:"过质保期"},{code:"24",name:"变色"},{code:"25",name:"入户门问题"}]),r({}),r([{code:"1",name:"订单分解错"},{code:"2",name:"订单漏分解"},{code:"3",name:"变形"}]),r([{code:"1",name:"漏备注"},{code:"2",name:"产品漏分解"},{code:"3",name:"配件漏分解"},{code:"4",name:"五金漏分解"},{code:"5",name:"孔位漏分解"}]),r([{label:"处理方式",value:"1"}]);const me=r([]),ha=r([{code:"1",name:"配送技工"},{code:"2",name:"安装技工"},{code:"3",name:"用户"},{code:"4",name:"经销商"}]),ba=r([{code:"0",name:"配送派工"},{code:"1",name:"安装派工"},{code:"2",name:"维修"}]),ga=r([{code:"1",name:"最高"},{code:"2",name:"高"},{code:"3",name:"中"},{code:"4",name:"低"}]),ya=r([{code:"0",name:"配送派工单"},{code:"1",name:"安装派工单"},{code:"2",name:"维修派工单"}]),ka=r([{code:"0",name:"待开始"},{code:"1",name:"进行中"},{code:"2",name:"已完成"}]),Ae=r([{code:"",name:"全部"},{code:"1",name:"开始"},{code:"2",name:"已提报问题"},{code:"3",name:"售后审核"},{code:"4",name:"已定损"},{code:"5",name:"定责发起"},{code:"6",name:"已提交OA审批"},{code:"7",name:"已追责"},{code:"8",name:"已追责"},{code:"8",name:"结束"}]),M=r(1),z=r(!1),Ca=r(!1),Ta=r(1),wa=()=>{X.value=!0},Me=r({files:[],name:"files"}),Ee=r({files:[],name:"files"}),Sa=t=>{Ee.value.files=[t]},Ia=t=>{Me.value.files=[t]};r({value1:"1",value2:"1",value3:"1",value4:"1",value5:"1",value6:"1"});const Va=()=>{q.value=2},ve=r({taskid:F.query.id,serviceCaseNeoId:F.query.serviceCaseId,orderId:F.query.orderId,taskStatus:ca,accountName:F.query.accountName,distributorName:F.query.distributorName,followerName:F.query.followerName,createdTime:F.query.createdTime,createdBy:F.query.createdBy});let _=ne({fieldJobContactName:"",contactTelephone:"",priority:"",type:"2",remark:"",appointmentStartTime:"",appointmentEndTime:"",haveInstallConditions:!1,fieldJobOrderId:F.query.orderId,fieldJobType__c:"2",stage__c:0,name:ve.value.accountName+"的配送派工单",fileList:[],filePath:[],followerId:null,address:"",source__c:1});const Je=ne({followerId:[{required:!0,message:"Please input username",trigger:"blur"}],fieldJobContactName:[{required:!0,message:"Please input username",trigger:"blur"}],contactTelephone:[{required:!0,message:"Please input phone",trigger:"blur"}],priority:[{required:!0,message:"Please input priority",trigger:"blur"}],appointmentStartTime:[{required:!0,message:"Please input appointment start time",trigger:"blur"}],appointmentEndTime:[{required:!0,message:"Please input appointment end time",trigger:"blur"}]}),Da=t=>{t.response},Na=t=>{if(t.code=="success"){let e=t.data.map(s=>s.fileId);e[0]&&_.filePath.push(e[0])}};let N=ne({processingProcessAndResults:"",followerId:null});const Pa=ne({followerId:[{required:!0,message:"请选择负责人",trigger:"blur"}],processingProcessAndResults:[{required:!0,message:"请输入经销商处理结论",trigger:"blur"}]});r({files:[],name:"files"});const Re=r({Content:"application/json",Authorization:"",isImage:"true",needFileId:"true","Trace-Id":""}),Be=t=>{fl({userType:1,name:"",phone:""}).then(s=>{let n=s.data.data;n!=null&&n.length>0?(W.value=n,t&&B({message:"查询成功",type:"success"})):t&&B({message:"获取数据失败",type:"error"})})},xa=t=>{let e=W.value.find(s=>s.id==t);e&&(N.follower=e.neoId,N.followerName=e.name)},La=t=>{let e=W.value.find(s=>s.id==t);e&&(_.fieldJobContactName=e.name,_.contactTelephone=e.phone)},Ua=()=>{let t={followerId:N.followerId,follower:N.follower,followerName:N.followerName,processingProcessAndResults:N.processingProcessAndResults,id:de.value,questionType:c.value.questionType,name:c.value.name};Ce(t).then(e=>{let s=e.data;s.code=="success"&&s.data!=null?(c.value.followerName=N.followerName,c.value.processingProcessAndResults=N.processingProcessAndResults,Object.keys(N).forEach(n=>{n!=="followerId"&&(N[n]=""),n=="followerId"&&(N[n]=null)}),C.$message.success("保存成功")):C.$message.warning("保存失败")})};r([]);const se=r([]);pl(()=>{je(),We(),Xe(),Ge(),ze(),Be(!1),ge(),be()});const Ye=()=>{je(),We(),Xe(),Ge(),ze(),Be(!1),ge(),be()},je=()=>{ml({id:de.value,neoid:H.value==null?"":H.value}).then(t=>{let e=t.data;if(e.code=="success"){c.value=e.data,p.value.orderNo=c.value.caseNo,te=c.value.caseStatus,N.processingProcessAndResults=c.value.processingProcessAndResults,ce.value=c.value.complaintSourceC.toString()=="4";var s="https://sh.mengtian.com.cn:9595/md/api/common/file/direct-download?fileId=";if(c.value.picture!=null&&c.value.picture.length>0){var n=[];c.value.picture.forEach(k=>{n.push(s+k)}),ue.value.push({picNo:c.value.picture.join(","),type:"问题提报图片",picture:n})}if(te===2){let k=c.value.dealerAcceptanceTime,V=new Date(k).getTime()+24*60*60*1e3;re=r(Math.floor((V-Date.now())/1e3)),Oa(re,V)}Wa(e.data.orderNeoId)}else C.$message.error(e==null?void 0:e.message)})},Oa=(t,e)=>{const s=setInterval(()=>{t.value=Math.floor((e-Date.now())/1e3),t.value<=0&&(clearInterval(s),ie="已受理阶段大于24小时")},1e3)},$a=t=>{const e=Math.floor(t/3600),s=Math.floor(t%3600/60),n=t%60;return ie||`${e.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},_e=t=>{q.value=t},ze=()=>{ta({deliveryDate:"",status__c:"",orderType__c:"",transactionDate:"",po:"",accountName:"",accountPhone:""}).then(e=>{let s=e.data;s.code=="success"?ra.value=s.data:C.$message.error(s==null?void 0:s.message)})},qa=()=>{if(L.value.forEach(e=>{e.checked=!1}),c.value.orderNeoId==null||c.value.orderNeoId.toString().length<=0){C.$message.warning("此问题提报未绑定订单，无法升级售后!");return}I.value=r([]),z.value=!0;let t={orderNoeId:c.value.orderNeoId};sa(t).then(e=>{let s=e.data;s.code=="success"?(s.data.forEach(n=>{n.serviceCaseNeoId==c.value.neoid?n.operate=!0:n.operate=!1}),K.value=s.data,K.value.forEach(n=>{n.checked=!1})):C.$message.error(s==null?void 0:s.message)})},fe=t=>{M.value=t},He=t=>{Ta.value=t,z.value=!1,Ca.value=!0},Fa=()=>{const t=K.value.filter(n=>n.checked&&n.operate);let e="是否新建售后工单?",s="新建售后工单";if(t.length>1){C.$message.warning("只能勾选一条已绑定的售后工单");return}t.length==1&&(e="是否对所选售后工单进行编辑?",s="编辑售后工单"),gl.confirm(e,s,{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(()=>{!p.value.remark&&t.length<=0?C.$message.error("经销商需求描述不能为空!"):t.length==1?he(t[0],!0):he(null,!1)}).catch(()=>{})},Aa=()=>{console.info("fileIdfileId",j.value);const t=L.value.filter(n=>n.checked);if(t.length<=0){C.$message.error("必须勾选数据!");return}let e=JSON.parse(JSON.stringify(t));e.forEach(n=>{n.picture=j.value,n.orderProductId=n.id,n.treeSpecies=n.treeSpecies__c,n.category=n.category1,n.paintColor=n.paintColor__c,n.ticketClassification=I.value.problemType,n.ticketProblem=I.value.afterSalesIssues,n.personLiable=I.value.responsiblePerson,n.descriptionOfTicketProblem=I.value.problemDesc,n.id=Q!=""?n.solutionDetailsId:null});let s={serviceTicket:Y.value.id,serviceTicketId:Y.value.neoId,serviceCaseId:parseInt(c.value.neoid),details:e};Q!=""&&(s.id=Q),console.info("selectDataselectData",t),!I.value.problemType||!I.value.afterSalesIssues||!I.value.responsiblePerson||!I.value.problemDesc?C.$message.error("必填选项不能为空!"):(C.$message.success("提交成功!"),setTimeout(()=>{z.value=!1,M.value=1,yl(s).then(n=>{console.log(n);let k=n.data.data;if(k!=null){Q=k.id;let u=k.details;u&&u.length>0&&t.forEach(V=>{let g=u.find(T=>V.id==T.orderProductId);if(g){V.descriptionOfTicketProblem=g.descriptionOfTicketProblem,V.ticketClassification=g.ticketClassification;let T="";g.ticketProblem.forEach(i=>{T=T+qe.value.find(S=>S.code==i).name+","}),V.ticketProblem=T.substring(0,T.length-1),V.responsibleSubject=g.responsibleSubject,V.solutionDetailsId=g.id}})}})},500))},Ma=()=>{ua.value=!0},Ea=()=>{if(c.value.caseStatus=="5"){C.$message.warning("问题提报已完成，无法修改");return}if(se.value.filter(e=>parseInt(e.status__c)>=2).length>0){C.$message.warning("存在处理中的售后工单,不允许修改");return}le.value=!0},We=()=>{ke("province").then(t=>{let e=t.data;e.code=="success"&&(Se.value=e.data)})},Xe=()=>{ke("city").then(t=>{let e=t.data;e.code=="success"&&(Ie.value=e.data)})},Ge=()=>{ke("district").then(t=>{let e=t.data;e.code=="success"&&(Ve.value=e.data)})},Ke=t=>{ta({po:t}).then(s=>{if(s.data.code=="success"){let n=s.data.data[0].id,k=s.data.data[0].po;we=parseInt(Y.value.neoId),Sl(n).then(u=>{let V=u.data.data.items;L.value=V,L.value.forEach(g=>{g.checked=!1,g.orderPo=k}),Il(we).then(g=>{if(g.data.code=="success"&&g.data.data!=null){Q=g.data.data.id;let T=g.data.data.details;T&&T.length>0?(L.value.forEach(i=>{let S=T.find(E=>i.id==E.orderProductId);if(S){i.descriptionOfTicketProblem=S.descriptionOfTicketProblem,i.ticketClassification=S.ticketClassification;let E="";S.ticketProblem.forEach(A=>{E=E+qe.value.find(oe=>oe.code==A).name+","}),i.ticketProblem=E.substring(0,E.length-1),i.responsibleSubject=S.responsibleSubject,i.solutionDetailsId=S.id}}),De.value=[[{label:"全部产品大类",value:"1"}],[...new Set(L.value.map(i=>i.category1))].map(i=>({label:i,value:i}))].reduce((i,S)=>i.concat(S),[]).filter(i=>i.label!=""),Ne.value=[[{label:"全部产品型号",value:"1"}],[...new Set(L.value.map(i=>i.fscProductModel))].map(i=>({label:i,value:i}))].reduce((i,S)=>i.concat(S),[]).filter(i=>i.label!=""),Le.value=[[{label:"全部尺寸",value:"1"}],[...new Set(L.value.map(i=>i.fscProductSpec))].map(i=>({label:i,value:i}))].reduce((i,S)=>i.concat(S),[]).filter(i=>i.label!=""),xe.value=[[{label:"全部油漆颜色",value:"1"}],[...new Set(L.value.map(i=>i.paintColor__c))].map(i=>({label:i,value:i}))].reduce((i,S)=>i.concat(S),[]).filter(i=>i.label!=""),Pe.value=[[{label:"全部树种",value:"1"}],[...new Set(L.value.map(i=>i.treeSpecies__c))].map(i=>({label:i,value:i}))].reduce((i,S)=>i.concat(S),[]).filter(i=>i.label!="")):console.info("details没数据"),G.value=L.value}})})}else C.$message.error("数据异常!")})},Y=r({}),he=(t,e)=>{if(!p.value.remark&&!e){C.$message.error("经销商需求备注不能为空!");return}let s={},n=!0;t!=null?(s={id:t.id,neoId:t.neoId,serviceCase__c:c.value.neoid,serviceCaseNeoId:c.value.neoid,distributorDemands__c:p.value.remark},n=!1):s={serviceCase__c:c.value.neoid,serviceCaseNeoId:c.value.neoid,distributorDemands__c:p.value.remark,problemDescription__c:c.value.problemDescription,customerPhone__c:c.value.phone,accountName:c.value.caseAccountName,customerAddress__c:c.value.address,accountNeoId:c.value.caseAccountId,distributorNeoId:c.value.distributorNeoId,distributorName:c.value.distributorName,distributorNo:U.value.distributorNo,storeNeoId:c.value.storeNeoId,storeName:c.value.storeName,storeNo:U.value.storeNo,status__c:"1",reporter__c:c.value.externalUserName,reporterPhone__c:c.value.externalUserPhone,ticketSource__c:"1",orderNeoId:U.value.neoid,orderType__c:U.value.orderType__c,productionOrderNo__c:U.value.productionOrderNo__c,region__c:U.value.region__c},kl(s).then(k=>{let u=k.data;if(u.code=="success"&&u.data!=null&&u.data.id!=null){if(n)Qe(u.data.id);else if(t.operate=!0,Y.value=t,M.value=2,Ke(p.value.orderNo),c.value.caseStatus===2){let V={id:c.value.id,questionType:c.value.questionType,name:c.value.name,caseStatus:3,dealerProcessingTime:na().format("YYYY-MM-DD HH:mm:ss"),processingProcessAndResults:p.value.remark};ea(V),setTimeout(()=>{Ye()},100)}e||B({message:"绑定售后工单成功",type:"success"})}else B({message:"绑定售后工单失败,请重试",type:"error"})}).catch(k=>{B({message:"绑定售后工单失败,请重试",type:"error"})})},Qe=t=>{Ja(),Cl(t).then(e=>{e.data.code=="success"&&e.data.data.neoId!=null?(Y.value=e.data.data,Y.value.operate=!0,K.value.push(Y.value),pe.close(),M.value=2,Ke(p.value.orderNo)):setTimeout(()=>{Qe(t)},1e3)}).catch(e=>{console.error("Error checking sync status:",e)})},Ja=()=>{pe==null&&(pe=Tl.service({fullscreen:!0,lock:!0,text:"等待数据同步完成",background:"rgba(0, 0, 0, 0.7)"}))},be=()=>{let t={serviceCaseNeoId:H.value};sa(t).then(e=>{let s=e.data.data;e.data.code=="success"&&(se.value=s)}).catch(e=>{B({message:"请求数据失败，请重试",type:"error"})})},Ze=t=>{C.$router.push({path:"/aftersales_workorder_details",query:{id:t.id}})},ge=()=>{let t={serviceCaseNeoId:H.value};vl(t).then(e=>{let s=e.data.data;e.data.code=="success"&&(me.value=s)}).catch(e=>{B({message:"请求数据失败，请重试",type:"error"})})},Ra=t=>{C.$router.push({path:"/dispatch_details",query:{id:t.id}})},Ba=()=>{ae.value=!0,ge(),be()},Ya=()=>{let t=_;t.fieldJobContactName=ve.value.accountName==null?"":ve.value.accountName.toString(),t.serviceCaseName=parseInt(H.value),t.fieldJobOrderId=U.value.neoid,t.contactTelephone=U.value.contactTel,t.fieldJobContactName=U.value.accountName__C,t.name=U.value.accountName__C+"的维修派工单",t.orderNo__c=U.value.po,t.picture=t.filePath,t.goodsPicture=t.filePath,t.status=0,wl(t).then(e=>{let s=e.data.data;if(ia.value.push(s),s!=null){if(c.value.caseStatus===2){let n={id:c.value.id,questionType:c.value.questionType,name:c.value.name,caseStatus:3,dealerProcessingTime:na().format("YYYY-MM-DD HH:mm:ss")};ea(n),setTimeout(()=>{Ye()},500)}B({message:"新增派工单成功",type:"success"})}else B({message:"新增派工单失败",type:"error"});Object.keys(_).forEach(n=>{!n.includes("type")&&!n.includes("haveInstallConditions")&&n!=="fieldJobOrderId"&&n!=="fieldJobType__c"&&n!=="stage__c"&&n!=="name"&&(_[n]=""),n==="haveInstallConditions"&&(_[n]=!1),(n=="fileList"||n=="filePath")&&(_[n]=[])})}).catch(e=>{B({message:"请求新增派工单失败，请重试",type:"error"}),Object.keys(_).forEach(s=>{s!=="type"&&s!=="haveInstallConditions"&&s!=="fieldJobOrderId"&&s!=="fieldJobType__c"&&s!=="stage__c"&&s!=="name"&&(_[s]=""),s=="haveInstallConditions"&&(_[s]=!1),(s=="fileList"||s=="filePath")&&(_[s]=[])}),console.error("请求新增派工单失败:",e)}),X.value=!1,q.value=1},ea=t=>{Ce(t).then(e=>{let s=e.data;s.code=="success"&&s.data!=null?console.info("更新成功"):console.info("更新失败")})},ja=t=>{let e=Se.value.find(s=>s.optionCode==t);return t&&e?e.optionLabel:""},za=t=>{let e=Ie.value.find(s=>s.optionCode==t);return t&&e?e.optionLabel:""},Ha=t=>{let e=Ve.value.find(s=>s.optionCode==t);return t&&e?e.optionLabel:""},U=r({}),Wa=t=>{t!=null&&_l(t).then(e=>{let s=e.data;s.code=="success"?(U.value=s.data,_.fieldJobOrderId=s.data.id,_.fieldJobContactName=s.data.accountName__C,_.name=s.data.accountName__C+"的维修派工单",p.value.orderNo=U.value.po):C.$message.error(s==null?void 0:s.message)})},aa=t=>t.getTime()<Date.now()-24*60*60*1e3,Xa=()=>{if(c.value.caseStatus==4){C.$message.warning("当前服务工单已完成!");return}if(c.value.processingProcessAndResults==null||c.value.processingProcessAndResults==""){C.$message.warning("处理结论不能为空，请先编辑处理结论");return}let t={caseStatus:4,id:de.value,questionType:c.value.questionType,name:c.value.name};Ce(t).then(e=>{let s=e.data;s.code=="success"&&s.data!=null?(c.value.caseStatus=4,C.$message.success("服务工单完成")):C.$message.warning("服务工单完成失败,请重试")}).catch(e=>{C.$message.error("服务工单完成失败,系统异常"),console.log("服务工单完成状态更新:",e)})},Ga=t=>{Fe.value=fa.value[t],I.value.afterSalesIssues=[]},Ka=t=>{L.value.forEach(e=>{e.checked=t})},Qa=t=>{p.value.productType="",p.value.productType="",p.value.productModel="",p.value.treeSpecies="",p.value.paintColor="",p.value.size="",p.value.orderType="",G.value=L.value},Za=t=>{Z()},el=t=>{Z()},al=t=>{Z()},ll=t=>{Z()},tl=t=>{Z()},Z=()=>{G.value=L.value.filter(t=>{let e=!0;p.value.size!=""&&p.value.size!="1"&&(e=t.fscProductSpec==p.value.size);let s=!0;p.value.productType!=""&&p.value.productType!="1"&&(s=t.category1==p.value.productType);let n=!0;p.value.productModel!=""&&p.value.productModel!="1"&&(n=t.fscProductModel==p.value.productModel);let k=!0;p.value.treeSpecies!=""&&p.value.treeSpecies!="1"&&(k=t.treeSpecies__c==p.value.treeSpecies);let u=!0;return p.value.paintColor!=""&&p.value.paintColor!="1"&&(u=t.paintColor__c==p.value.paintColor),e&&n&&s&&k&&u}),console.log(G)};return(t,e)=>{var la;const s=$("el-button"),n=$("el-checkbox"),k=$("el-input"),u=$("el-table-column"),V=$("el-table"),g=$("el-option"),T=$("el-select"),i=$("el-icon"),S=$("el-upload"),E=$("el-dialog"),A=$("el-form-item"),oe=$("el-date-picker"),ye=$("el-form"),sl=$("el-image");return v(),D("div",Dl,[a("span",Nl,[a("span",Pl,[xl,o(s,{class:"btn",onClick:qa},{default:d(()=>[y("升级到总部 (售后)")]),_:1})]),a("span",Ll,[a("span",Ul,[a("span",{class:P(c.value.caseStatus==1?"num_selected":"num")},"1",2),a("span",{class:P(c.value.caseStatus>=1?"name_selected":"name")},"待处理",2)]),a("span",Ol,[a("span",{class:P(c.value.caseStatus==2?"num_selected":"num")},"2",2),a("span",{class:P(c.value.caseStatus>=2?"name_selected":"name")},"已受理",2)]),a("span",$l,[a("span",{class:P(c.value.caseStatus==3?"num_selected":"num")},"3",2),a("span",{class:P(c.value.caseStatus>=3?"name_selected":"name")},"处理中",2)]),a("span",ql,[a("span",{onClick:Xa,class:P(c.value.caseStatus==4?"num_selected":"num")},"4",2),a("span",{class:P(c.value.caseStatus>=4?"name_selected":"name")},"已完成",2)])])]),a("span",Fl,[a("span",Al,[y("问题提报详情"),a("span",Ml,h(f(te)<=2&&f(te)>0?$a(f(re)):""),1)]),a("span",El,[a("span",Jl,[a("span",Rl,[Bl,a("span",Yl,h(c.value.caseNo),1),R("",!0)]),a("span",jl,[zl,a("span",Hl,h(c.value.storeName),1)]),a("span",Wl,[Xl,a("span",Gl,h(c.value.questionType=="1"?"售后保修":"投诉建议"),1)])]),a("span",Kl,[a("span",Ql,[Zl,a("span",et,h(U.value.po),1)]),a("span",at,[lt,a("span",tt,h(c.value.followerName),1)]),a("span",st,[ot,a("span",nt,h(c.value.createdTime),1)])]),a("span",dt,[a("span",ct,[rt,a("span",it,h(c.value.problemDescription),1)]),a("span",ut,[pt,a("span",mt,h(c.value.complaintSourceC?(la=ha.value.find(l=>l.code==c.value.complaintSourceC))==null?void 0:la.name:""),1)]),a("span",vt,[_t,a("span",ft,h(c.value.externalUserName),1)])]),a("span",ht,[a("span",bt,[gt,a("span",yt,h(c.value.externalUserPhone),1)])])]),kt,a("span",Ct,[a("span",Tt,[a("span",wt,[St,a("span",It,h(c.value.customerName),1)]),a("span",Vt,[Dt,a("span",Nt,h(c.value.phone),1)]),a("span",Pt,[xt,a("span",Lt,h(c.value.processingProcessAndResults),1)])]),a("span",Ut,[a("span",Ot,[$t,a("span",qt,h(ja(c.value.province)),1)]),a("span",Ft,[At,a("span",Mt,h(za(c.value.city)),1)]),a("span",Et,[Jt,a("span",Rt,h(Ha(c.value.district)),1)])]),a("span",Bt,[a("span",Yt,[jt,o(n,{modelValue:ce.value,"onUpdate:modelValue":e[0]||(e[0]=l=>ce.value=l),disabled:""},null,8,["modelValue"])])])])]),a("span",zt,[Ht,o(s,{class:"btn"},{default:d(()=>[y(h(se.value.length)+"个售后工单",1)]),_:1}),o(s,{class:"btn"},{default:d(()=>[y(h(me.value.length)+"个派工单",1)]),_:1}),o(s,{class:"btn"},{default:d(()=>[y(h(ue.value.length)+"个附件",1)]),_:1}),a("span",{class:"view",onClick:Ba},"点击查看")]),a("span",Wt,[a("div",{class:"left"},[Xt,a("span",{class:"initiate_comments",onClick:Ma},"发起评论")]),a("div",Gt,[o(s,{type:"primary",onClick:Ea,class:"primary_btn"},{default:d(()=>[y("编辑")]),_:1}),o(s,{type:"primary",onClick:wa,class:"primary_btn"},{default:d(()=>[y("创建派工单")]),_:1})])]),(v(!0),D(x,null,O(da.value,l=>(v(),D("div",{class:"comment",key:l.date},[a("div",Kt,[Qt,a("span",Zt,h(l.userName),1)]),a("div",es,h(l.text),1),a("div",as,h(l.date),1),ls,ts]))),128)),a("div",ss,[o(E,{modelValue:z.value,"onUpdate:modelValue":e[20]||(e[20]=l=>z.value=l),title:"升级到总部 (售后)",width:"80% ","show-close":!1},{footer:d(()=>[a("div",qs,[o(s,{class:"cancel_btn",onClick:e[19]||(e[19]=l=>z.value=!1)},{default:d(()=>[y("取消")]),_:1}),M.value==1?(v(),w(s,{key:0,onClick:Fa,type:"primary",class:"primary_btn",style:{"margin-left":"50px !important"}},{default:d(()=>[y("下一步")]),_:1})):R("",!0),M.value==2?(v(),w(s,{key:1,onClick:Aa,type:"primary",class:"primary_btn",style:{"margin-left":"50px !important"}},{default:d(()=>[y("提交")]),_:1})):R("",!0)])]),default:d(()=>[a("div",os,[a("span",ns,[a("span",{onClick:e[1]||(e[1]=l=>fe(1)),class:P(M.value==1?"num_selected":"num")},"1",2),ds]),a("span",cs,[a("span",{onClick:e[2]||(e[2]=l=>fe(2)),class:P(M.value==2?"num_selected":"num")},"2",2),rs]),a("span",is,[a("span",{onClick:e[3]||(e[3]=l=>fe(3)),class:P(M.value==3?"num_selected":"num")},"3",2),us])]),M.value==1?(v(),D(x,{key:0},[a("span",ps,[ms,o(k,{disabled:"",modelValue:p.value.orderNo,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value.orderNo=l),placeholder:"订单编号",style:{width:"auto"}},null,8,["modelValue"])]),a("div",vs,[_s,o(k,{modelValue:p.value.remark,"onUpdate:modelValue":e[5]||(e[5]=l=>p.value.remark=l),placeholder:"输入升级描述",style:{width:"auto"}},null,8,["modelValue"])]),fs,a("div",hs,[o(V,{ref_key:"multipleTableRef",ref:Ue,"selection-change":Oe,data:K.value,stripe:!1,style:{width:"100%",overflow:"auto"},"max-height":"400"},{default:d(()=>[o(u,{prop:"checked",label:"全选",width:"80px"},{default:d(l=>[l.row.operate==!1?(v(),w(n,{key:0,disabled:"",modelValue:l.row.checked,"onUpdate:modelValue":b=>l.row.checked=b},null,8,["modelValue","onUpdate:modelValue"])):R("",!0),l.row.operate==!0?(v(),w(n,{key:1,modelValue:l.row.checked,"onUpdate:modelValue":b=>l.row.checked=b},null,8,["modelValue","onUpdate:modelValue"])):R("",!0)]),_:1}),o(u,{prop:"name",label:"售后工单编号"},{default:d(l=>[a("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:b=>Ze(l.row)},h(l.row.name),9,bs)]),_:1}),o(u,{prop:"distributorNo",label:"经销商名称"}),o(u,{prop:"storeName",label:"专卖店名称"}),o(u,{prop:"status__c",label:"状态"},{default:d(l=>{var b;return[a("div",gs,h(l.row.status__c?(b=Ae.value.find(J=>J.code==l.row.status__c))==null?void 0:b.name:""),1)]}),_:1}),o(u,{prop:"reporter__c",label:"提报人"}),o(u,{prop:"problemDescription__c",label:"问题描述 "}),o(u,{prop:"distributorDemands__c",label:"经销商需求描述 "}),o(u,{prop:"createdTime",label:"创建时间 "}),o(u,{prop:"operate",label:"操作"},{default:d(l=>[l.row.operate?(v(),w(n,{key:0,disabled:"",modelValue:l.row.operate,"onUpdate:modelValue":b=>l.row.operate=b,value:l.row.operate,style:{"--el-disabled-text-color":"#ff8127","--el-checkbox-disabled-checked-icon-color":"white","--el-checkbox-disabled-checked-input-fill":"#ff8127","--el-checkbox-text-color":"#ff8127"}},{default:d(()=>[y("已绑定")]),_:2},1032,["modelValue","onUpdate:modelValue","value"])):(v(),D("div",{key:1,style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:b=>he(l.row,!1)}," 点击绑定 ",8,ys))]),_:1})]),_:1},8,["data"])])],64)):R("",!0),M.value==2?(v(),D(x,{key:1},[a("div",ks,[Cs,a("span",Ts,[o(s,{style:{display:"none"},class:"btn",onClick:e[6]||(e[6]=l=>He(1))},{default:d(()=>[y("完善问题描述")]),_:1}),o(s,{style:{display:"none"},class:"btn",onClick:e[7]||(e[7]=l=>He(2))},{default:d(()=>[y("定义处理方式")]),_:1})])]),a("div",ws,[o(T,{modelValue:p.value.orderType,"onUpdate:modelValue":e[8]||(e[8]=l=>p.value.orderType=l),placeholder:"清除筛选",onChange:Qa},{default:d(()=>[(v(!0),D(x,null,O(pa.value,l=>(v(),w(g,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(T,{modelValue:p.value.productType,"onUpdate:modelValue":e[9]||(e[9]=l=>p.value.productType=l),placeholder:"产品大类",onChange:Za},{default:d(()=>[(v(!0),D(x,null,O(De.value,l=>(v(),w(g,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(T,{modelValue:p.value.productModel,"onUpdate:modelValue":e[10]||(e[10]=l=>p.value.productModel=l),placeholder:"产品型号",onChange:el},{default:d(()=>[(v(!0),D(x,null,O(Ne.value,l=>(v(),w(g,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(T,{modelValue:p.value.treeSpecies,"onUpdate:modelValue":e[11]||(e[11]=l=>p.value.treeSpecies=l),placeholder:"树种",onChange:al},{default:d(()=>[(v(!0),D(x,null,O(Pe.value,l=>(v(),w(g,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(T,{modelValue:p.value.paintColor,"onUpdate:modelValue":e[12]||(e[12]=l=>p.value.paintColor=l),placeholder:"油漆颜色",onChange:ll},{default:d(()=>[(v(!0),D(x,null,O(xe.value,l=>(v(),w(g,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(T,{modelValue:p.value.size,"onUpdate:modelValue":e[13]||(e[13]=l=>p.value.size=l),placeholder:"尺寸",onChange:tl},{default:d(()=>[(v(!0),D(x,null,O(Le.value,l=>(v(),w(g,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),a("div",Ss,[o(V,{ref_key:"multipleTableRef",ref:Ue,"selection-change":Oe,data:G.value,stripe:!1,style:{width:"100%",overflow:"auto"},"max-height":"200"},{default:d(()=>[o(u,{prop:"checked",label:"全选",width:"80px"},{header:d(()=>[o(n,{onChange:Ka},{default:d(()=>[y("全选")]),_:1})]),default:d(l=>[o(n,{modelValue:l.row.checked,"onUpdate:modelValue":b=>l.row.checked=b},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(u,{prop:"orderPo",label:"订单编号"}),o(u,{prop:"sku",label:"详单编号"}),o(u,{prop:"category1",label:"产品大类"}),o(u,{prop:"fscProductModel",label:"产品型号"}),o(u,{prop:"treeSpecies__c",label:"树种"}),o(u,{prop:"paintColor__c",label:"油漆颜色 "}),o(u,{prop:"fscProductSpec",label:"尺寸 "}),o(u,{prop:"ticketClassification",label:"问题大类"},{default:d(l=>{var b;return[a("div",Is,h(l.row.ticketClassification?(b=$e.value.find(J=>J.code==l.row.ticketClassification))==null?void 0:b.name:""),1)]}),_:1}),o(u,{prop:"ticketProblem",label:"售后问题 "}),o(u,{prop:"",label:"责任人 "}),o(u,{prop:"descriptionOfTicketProblem",label:"问题描述 "})]),_:1},8,["data"])]),a("div",Vs,[Ds,o(T,{modelValue:I.value.problemType,"onUpdate:modelValue":e[14]||(e[14]=l=>I.value.problemType=l),placeholder:"",onChange:Ga},{default:d(()=>[(v(!0),D(x,null,O($e.value,l=>(v(),w(g,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ns,o(T,{multiple:"","collapse-tags":"",modelValue:I.value.afterSalesIssues,"onUpdate:modelValue":e[15]||(e[15]=l=>I.value.afterSalesIssues=l),placeholder:""},{default:d(()=>[(v(!0),D(x,null,O(Fe.value,l=>(v(),w(g,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),Ps,o(k,{modelValue:I.value.responsiblePerson,"onUpdate:modelValue":e[16]||(e[16]=l=>I.value.responsiblePerson=l),style:{width:"240px"},placeholder:"请输入责任人"},null,8,["modelValue"])]),a("div",xs,[Ls,o(k,{modelValue:I.value.problemDesc,"onUpdate:modelValue":e[17]||(e[17]=l=>I.value.problemDesc=l),style:{width:"440px"},rows:2,type:"textarea",placeholder:"请输入问题描述"},null,8,["modelValue"])]),Us,a("div",Os,[a("span",$s,[o(S,{"on-success":ma,"on-remove":va,"auto-upload":!0,data:Ee.value,headers:Re.value,"before-upload":Sa,"list-type":"picture-card",class:"avatar-uploader",action:"https://sh.mengtian.com.cn:9595/md/api/common/file/upload","show-file-list":!0,"file-list":I.value.fileList,"onUpdate:fileList":e[18]||(e[18]=l=>I.value.fileList=l)},{default:d(()=>[o(i,null,{default:d(()=>[o(f(oa))]),_:1})]),_:1},8,["data","headers","file-list"])])])],64)):R("",!0)]),_:1},8,["modelValue"])]),a("div",Fs,[o(E,{modelValue:X.value,"onUpdate:modelValue":e[33]||(e[33]=l=>X.value=l),title:"新建配送派工单",width:"80%","show-close":!1},{footer:d(()=>[a("div",Hs,[o(s,{class:"cancel_btn",onClick:e[32]||(e[32]=l=>X.value=!1)},{default:d(()=>[y("取消")]),_:1}),q.value==1?(v(),w(s,{key:0,type:"primary",class:"primary_btn",onClick:Va},{default:d(()=>[y("下一步")]),_:1})):R("",!0),q.value==2?(v(),w(s,{key:1,type:"primary",class:"primary_btn",onClick:Ya},{default:d(()=>[y("完成")]),_:1})):R("",!0)])]),default:d(()=>[a("div",As,[a("span",Ms,[a("span",{onClick:e[21]||(e[21]=l=>_e(1)),class:P(q.value==1?"num_selected":"num")},"1",2),a("span",{class:P(q.value>=1?"name_selected":"name")},[y("选择配送司机 "),Es],2)]),a("span",Js,[a("span",{onClick:e[22]||(e[22]=l=>_e(2)),class:P(q.value==2?"num_selected":"num")},"2",2),a("span",{class:P(q.value>=2?"name_selected":"name")},[y("输入派工单注意事项 "),Rs],2)]),a("span",Bs,[a("span",{onClick:e[23]||(e[23]=l=>_e(3)),class:P(q.value==3?"num_selected":"num")},"3",2),a("span",{class:P(q.value>=3?"name_selected":"name")},[y("完成创建 "),Ys],2)])]),a("div",js,[q.value==1?(v(),w(ye,{key:0,model:f(_),rules:Je,ref:"deliveryOrderFormRef","label-width":"90px","label-position":"left"},{default:d(()=>[o(A,{label:"人员名称",prop:"followerId"},{default:d(()=>[o(T,{modelValue:f(_).followerId,"onUpdate:modelValue":e[24]||(e[24]=l=>f(_).followerId=l),onChange:La,placeholder:"查找或输入服务人员姓名"},{default:d(()=>[(v(!0),D(x,null,O(W.value,l=>(v(),w(g,{key:l.name,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),zs]),_:1}),o(A,{label:"联系方式",prop:"contactTelephone"},{default:d(()=>[o(k,{modelValue:f(_).contactTelephone,"onUpdate:modelValue":e[25]||(e[25]=l=>f(_).contactTelephone=l),placeholder:"查找或输入配送司机手机号码"},null,8,["modelValue"])]),_:1}),o(A,{label:"预约开始",prop:"appointmentStartTime"},{default:d(()=>[o(oe,{modelValue:f(_).appointmentStartTime,"onUpdate:modelValue":e[26]||(e[26]=l=>f(_).appointmentStartTime=l),type:"datetime",placeholder:"日期/时间","value-format":"YYYY-MM-DD HH:mm:ss","default-time":f(Te),"disabled-date":aa},null,8,["modelValue","default-time"])]),_:1}),o(A,{label:"预约结束",prop:"appointmentEndTime"},{default:d(()=>[o(oe,{modelValue:f(_).appointmentEndTime,"onUpdate:modelValue":e[27]||(e[27]=l=>f(_).appointmentEndTime=l),type:"datetime",placeholder:"日期/时间","value-format":"YYYY-MM-DD HH:mm:ss","default-time":f(Te),"disabled-date":aa},null,8,["modelValue","default-time"])]),_:1})]),_:1},8,["model","rules"])):R("",!0),q.value==2?(v(),w(ye,{key:1,model:f(_),rules:Je,ref:"deliveryOrderFormRef","label-width":"90px","label-position":"left"},{default:d(()=>[o(A,{label:"优先级",prop:"priority"},{default:d(()=>[o(T,{modelValue:f(_).priority,"onUpdate:modelValue":e[28]||(e[28]=l=>f(_).priority=l),placeholder:"选择优先级"},{default:d(()=>[(v(!0),D(x,null,O(ga.value,l=>(v(),w(g,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(A,{label:"派工类型",prop:"fieldJobType__c"},{default:d(()=>[o(T,{modelValue:f(_).fieldJobType__c,"onUpdate:modelValue":e[29]||(e[29]=l=>f(_).fieldJobType__c=l),placeholder:"选择派工类型"},{default:d(()=>[(v(!0),D(x,null,O(ba.value,l=>(v(),w(g,{key:l.code,label:l.name,value:l.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(A,{label:"派工单备注",class:"customLayout"},{default:d(()=>[o(k,{modelValue:f(_).remark,"onUpdate:modelValue":e[30]||(e[30]=l=>f(_).remark=l),rows:5,type:"textarea",maxlength:"500",placeholder:"请填写派工单备注","show-word-limit":""},null,8,["modelValue"])]),_:1}),o(A,{label:"上传图片",class:"custom_upload"},{default:d(()=>[o(S,{"on-success":Na,"on-remove":Da,"auto-upload":!0,data:Me.value,headers:Re.value,"before-upload":Ia,"file-list":f(_).fileList,"onUpdate:fileList":e[31]||(e[31]=l=>f(_).fileList=l),class:"avatar-uploader",action:"https://sh.mengtian.com.cn:9595/md/api/common/file/upload","show-file-list":!0,"list-type":"picture-card"},{default:d(()=>[o(i,{class:"avatar-uploader-icon"},{default:d(()=>[o(f(oa))]),_:1})]),_:1},8,["data","headers","file-list"])]),_:1})]),_:1},8,["model","rules"])):R("",!0)])]),_:1},8,["modelValue"])]),a("div",Ws,[o(E,{modelValue:le.value,"onUpdate:modelValue":e[37]||(e[37]=l=>le.value=l),title:"编辑",width:"40%","show-close":!1},{footer:d(()=>[a("div",Gs,[o(s,{class:"cancel_btn",onClick:e[36]||(e[36]=l=>le.value=!1)},{default:d(()=>[y("取消")]),_:1}),o(s,{type:"primary",class:"primary_btn",onClick:Ua},{default:d(()=>[y("保存")]),_:1})])]),default:d(()=>[a("div",Xs,[o(ye,{model:f(N),rules:Pa,ref:"deditFollowerAndPDescriptFormRef","label-width":"90px","label-position":"left"},{default:d(()=>[o(A,{label:"负责人",prop:"followerId"},{default:d(()=>[o(T,{modelValue:f(N).followerId,"onUpdate:modelValue":e[34]||(e[34]=l=>f(N).followerId=l),onChange:xa,placeholder:"请选择负责人"},{default:d(()=>[(v(!0),D(x,null,O(W.value,l=>(v(),w(g,{key:l.name,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(A,{label:"经销商处理结论",prop:"processingProcessAndResults"},{default:d(()=>[o(k,{modelValue:f(N).processingProcessAndResults,"onUpdate:modelValue":e[35]||(e[35]=l=>f(N).processingProcessAndResults=l),placeholder:"请输入经销商处理结论"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])]),a("div",Ks,[o(E,{modelValue:ae.value,"onUpdate:modelValue":e[39]||(e[39]=l=>ae.value=l),title:"相关单据",width:"80%","show-close":!1},{footer:d(()=>[a("div",vo,[o(s,{type:"primary",class:"primary_btn",onClick:e[38]||(e[38]=l=>ae.value=!1)},{default:d(()=>[y("返回")]),_:1})])]),default:d(()=>[a("div",Qs,[a("span",Zs,[eo,a("span",ao,[o(V,{data:se.value,stripe:!1,style:{width:"100%"}},{default:d(()=>[o(u,{prop:"name",label:"售后工单编号"}),o(u,{prop:"serviceTicketType__c",label:"类别"}),o(u,{prop:"text3",label:"负责人"}),o(u,{prop:"status__c",label:"状态"},{default:d(l=>{var b;return[a("div",lo,h(l.row.status__c?(b=Ae.value.find(J=>J.code==l.row.status__c))==null?void 0:b.name:""),1)]}),_:1}),o(u,{prop:"updatedTime",label:"修改时间"}),o(u,{label:"操作",width:"80px"},{default:d(l=>[a("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:b=>Ze(l.row)}," 查看 ",8,to)]),_:1})]),_:1},8,["data"])])]),a("span",so,[oo,a("span",no,[o(V,{data:me.value,stripe:!1,style:{width:"100%"}},{default:d(()=>[o(u,{prop:"caseNo",label:"派工单编号"}),o(u,{prop:"fieldJobType__c",label:"类别"},{default:d(l=>{var b;return[a("div",co,h(l.row.fieldJobType__c?(b=ya.value.find(J=>J.code==l.row.fieldJobType__c))==null?void 0:b.name:"配送派工单"),1)]}),_:1}),o(u,{prop:"followerName",label:"负责人"}),o(u,{prop:"status",label:"状态"},{default:d(l=>{var b;return[a("div",ro,h(l.row.stage__c?(b=ka.value.find(J=>J.code==l.row.stage__c))==null?void 0:b.name:"待开始"),1)]}),_:1}),o(u,{prop:"updatedTime",label:"修改时间"}),o(u,{label:"操作",width:"80px"},{default:d(l=>[a("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:b=>Ra(l.row)}," 查看 ",8,io)]),_:1})]),_:1},8,["data"])])]),a("span",uo,[po,a("span",mo,[o(V,{data:ue.value,stripe:!1,style:{width:"100%"},"max-height":"150"},{default:d(()=>[o(u,{prop:"picNo",label:"附件编号"}),o(u,{prop:"type",label:"类型"}),o(u,{prop:"text3",label:"附件链接"},{default:d(({row:l})=>[(v(!0),D(x,null,O(l.picture,(b,J)=>(v(),w(sl,{key:J,style:{"margin-right":"5px",width:"50px"},src:b,"preview-src-list":l.picture},null,8,["src","preview-src-list"]))),128))]),_:1})]),_:1},8,["data"])])])])]),_:1},8,["modelValue"])])])}}}),yo=Vl(_o,[["__scopeId","data-v-b349d084"]]);export{yo as default};
