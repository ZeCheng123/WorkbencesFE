import{_ as ce,a as de,b as ie}from"./logoXX-Cy74BE6B.js";import{_ as me}from"./plus-B8sn_dc4.js";import{_ as pe}from"./download-Dan4AgsM.js";import{d as _e,g as fe,r as d,a as ve,k as ge,m as he,$ as be,L as Ne,c as P,b as r,e as l,w as o,f as i,p as Se,h as ye,o as b,F as $,x as L,B as z,i as g,t as q,D as F,y as Ve,E as Ce,A as B,_ as De}from"./index-1-lRGkZt.js";import{h as xe}from"./moment-Cl4UOzQZ.js";const p=x=>(Se("data-v-9caff225"),x=x(),ye(),x),Pe={class:"main"},ke=p(()=>r("span",{class:"header"},[r("span",{class:"title"},"问题提报")],-1)),Ue={class:"search"},we={class:"left"},Ie=p(()=>r("span",{style:{width:"336px",height:"32px"}},null,-1)),Te={class:"right"},$e=p(()=>r("img",{src:de,alt:""},null,-1)),Le=p(()=>r("img",{src:ie,alt:""},null,-1)),ze={class:"table_header"},Ye=p(()=>r("span",{class:"left"},[r("img",{src:ce,alt:""}),r("span",{class:"title"})],-1)),Re={class:"right"},Me=p(()=>r("img",{src:me,alt:""},null,-1)),qe=p(()=>r("img",{src:pe,alt:""},null,-1)),Fe={class:"table"},Be={style:{display:"flex","align-items":"center"}},Oe={style:{display:"flex","align-items":"center"}},Ae=["onClick"],Ee={class:"problemReportingDialog"},He={class:"step"},je={class:"item"},Ge=p(()=>r("span",{class:"name"},[g("完善提报信息 "),r("span",{class:"remark"},"完善问题提报的信息")],-1)),Je={class:"item"},Ke=p(()=>r("span",{class:"name"},[g("完成创建 "),r("span",{class:"remark"},"等待售服部处理")],-1)),Qe={class:"content"},We={class:"dialog-footer"},Xe=_e({__name:"index",setup(x){const{proxy:_}=fe(),f=d({pageIndex:1,pageSize:15,total:0}),O=d({Content:"application/json",Authorization:"",isImage:"true",needFileId:"true","Trace-Id":""}),Y=d({files:[],name:"files"}),s=ve({problemNo:"",customerName:"",customerPhone:"",filterMethod:"",createDate:[],tableData:[],orderStatus:""});d([{value:"all",label:"全部"}]),d([{value:"all",label:"全部"}]);const A=d([{name:"配送技工",code:"1"},{name:"安装技工",code:"2"},{name:"用户",code:"3"},{name:"经销商",code:"4"}]),R=d([{name:"全部",code:""},{name:"待处理",code:"1"},{name:"已受理",code:"2"},{name:"处理中",code:"3"},{name:"已完成",code:"4"}]),y=d(!1),M=d(1),u=d({orderNo:"",customerName:"",customerPhone:"",desc:"",fileList:[],filePath:[]}),E=d({customerName:[{required:!0,message:"客户姓名不能为空！",trigger:"blur"}],customerPhone:[{required:!0,message:"客户电话不能为空！",trigger:"blur"}],desc:[{required:!0,message:"问题描述不能为空！",trigger:"blur"}]}),k=d([]),U=d([]),w=d([]),V=d({});ge(()=>{setTimeout(()=>{C(),K(),Q()},500)});const H=n=>{let e=n.id,t=n.neoid,c=n.caseStatus,D=n.createdTime,I=n.name,N=n.questionType,h="id="+e,m={};t!=null&&(h=h+"&neoid="+t,c===1&&D!=null&&(m={id:e,questionType:N||0,name:I,caseStatus:2,dealerAcceptanceTime:xe().format("YYYY-MM-DD HH:mm:ss")},console.info("params",m)),j(m,h))},j=(n,e)=>{n.id!=null?B(n).then(t=>{let c=t.data;c.code=="success"&&c.data!=null?(_.$router.push(`/problem_report_details?${e}`),console.info("更新成功")):console.info("更新失败")}):_.$router.push(`/problem_report_details?${e}`)},G=()=>{y.value=!0},J=()=>{console.log("problemReportingForm",u.value);for(let e in u.value)if(e!="orderNo"&&e!="fileList"&&e!="filePath"&&u.value[e]==""){_.$message.error("必填字段不能为空!");return}let n={orderNeoId:u.value.orderNo,name:V.value.accountName__C+"的服务工单",externalUserName:u.value.customerName,externalUserPhone:u.value.customerPhone,problemDescription:u.value.desc,picture:u.value.filePath,caseStatus:"1",questionType:1,caseSource:11,clientCaseStatusC:1,complaintSourceC:4,phone:V.value.contactTel,customerName:V.value.accountName__C,address:V.value.customerAddress};B(n).then(e=>{let t=e.data;t.code=="success"?(u.value={orderNo:"",customerName:"",customerPhone:"",desc:"",fileList:[],filePath:[]},y.value=!1,_.$message.success("提交成功!"),C()):_.$message.error(t==null?void 0:t.message)})},C=()=>{let n={caseStatus:s.orderStatus==null?"":s.orderStatus,caseNo:s.problemNo==null?"":s.problemNo,accountName:s.customerName==null?"":s.customerName,accountPhone:s.customerPhone==null?"":s.customerPhone,from:s.createDate==null||s.createDate[0]==null?"":s.createDate[0]+" 00:00:00",to:s.createDate==null||s.createDate[1]==null?"":s.createDate[1]+" 23:59:59",pageSize:f.value.pageSize,pageNo:f.value.pageIndex};he(n).then(e=>{let t=e.data;t.code=="success"?(k.value=t.data,f.value={pageIndex:e.data.current==null?1:parseInt(e.data.current),pageSize:e.data.size,total:e.data.total}):(_.$message.error(t==null?void 0:t.message),k.value=[],f.value={pageIndex:1,pageSize:15,total:0})})},K=()=>{be({deliveryDate:"",status__c:"",orderType__c:"",transactionDate:"",po:"",accountName:"",accountPhone:""}).then(e=>{let t=e.data;t.code=="success"?U.value=t.data:_.$message.error(t==null?void 0:t.message)})},Q=()=>{Ne({userType:1,name:"",phone:""}).then(e=>{let t=e.data.data;t!=null&&t.length>0?w.value=t:_.$message.warning("未获取到人员数据")})},W=n=>{let e=w.value.find(t=>t.neoId==n);e&&(u.value.customerName=e.name,u.value.customerPhone=e.phone)},X=n=>{let e=U.value.find(t=>t.neoid==n);e&&(V.value=e)},Z=n=>{if(console.log(n),n.code=="success"){let e=n.data.map(t=>t.fileId);u.value.filePath=u.value.filePath.concat(e),console.log(u.value.filePath)}},ee=n=>{var e=n.response;console.log(e)},ae=n=>{Y.value.files=[n]},le=()=>{console.log("aaaa"),s.problemNo=null,s.customerName=null,s.customerPhone=null,s.filterMethod=null,s.createDate=[],s.orderStatus=null,C()},te=n=>{f.value.pageIndex=n,C()};return(n,e)=>{const t=i("el-input"),c=i("el-form-item"),D=i("el-form"),I=i("el-date-picker"),N=i("el-option"),h=i("el-select"),m=i("el-button"),v=i("el-table-column"),oe=i("el-table"),se=i("el-pagination"),ne=i("el-icon"),re=i("el-upload"),ue=i("el-dialog");return b(),P("div",Pe,[ke,r("span",Ue,[r("span",we,[l(D,{model:s,rules:n.rule,"label-width":"80px","label-position":"left"},{default:o(()=>[l(c,{label:"问题编号"},{default:o(()=>[l(t,{placeholder:"请输入问题编号",modelValue:s.problemNo,"onUpdate:modelValue":e[0]||(e[0]=a=>s.problemNo=a)},null,8,["modelValue"])]),_:1}),l(c,{label:"客户名称"},{default:o(()=>[l(t,{placeholder:"输入客户名称",modelValue:s.customerName,"onUpdate:modelValue":e[1]||(e[1]=a=>s.customerName=a)},null,8,["modelValue"])]),_:1}),l(c,{label:"客户电话"},{default:o(()=>[l(t,{placeholder:"请输入客户电话",modelValue:s.customerPhone,"onUpdate:modelValue":e[2]||(e[2]=a=>s.customerPhone=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"]),l(D,{model:s,rules:n.rule,"label-width":"80px","label-position":"left"},{default:o(()=>[l(c,{label:"创建时间"},{default:o(()=>[l(I,{modelValue:s.createDate,"onUpdate:modelValue":e[3]||(e[3]=a=>s.createDate=a),type:"daterange","range-separator":"~","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),l(c,{label:"问题状态"},{default:o(()=>[l(h,{modelValue:s.orderStatus,"onUpdate:modelValue":e[4]||(e[4]=a=>s.orderStatus=a),placeholder:"请选择问题状态"},{default:o(()=>[(b(!0),P($,null,L(R.value,a=>(b(),z(N,{key:a.code,label:a.name,value:a.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),Ie]),_:1},8,["model","rules"])]),r("span",Te,[l(m,{type:"primary",onClick:C,class:"search_btn"},{icon:o(()=>[$e]),default:o(()=>[g("查询")]),_:1}),l(m,{type:"primary",onClick:e[5]||(e[5]=a=>le()),class:"reset_btn"},{icon:o(()=>[Le]),default:o(()=>[g("重置")]),_:1})])]),r("span",ze,[Ye,r("span",Re,[l(m,{onClick:G,type:"primary",class:"search_btn"},{icon:o(()=>[Me]),default:o(()=>[g("新建")]),_:1}),l(m,{type:"primary",class:"reset_btn"},{icon:o(()=>[qe]),default:o(()=>[g("下载")]),_:1})])]),r("span",Fe,[l(oe,{class:"table_content",data:k.value,stripe:!1,style:{width:"100%"}},{default:o(()=>[l(v,{prop:"caseNo",label:"问题编号"}),l(v,{prop:"name",label:"客户姓名"}),l(v,{prop:"problemDescription",label:"问题描述"}),l(v,{prop:"complaintSourceC",label:"来源"},{default:o(a=>{var S;return[r("div",Be,q(a.row.complaintSourceC?(S=A.value.find(T=>T.code==a.row.complaintSourceC))==null?void 0:S.name:""),1)]}),_:1}),l(v,{prop:"externalUserName",label:"提报人"}),l(v,{prop:"createdTime",label:"创建时间"}),l(v,{prop:"caseStatus",label:"问题状态"},{default:o(a=>{var S;return[r("div",Oe,q(a.row.caseStatus?(S=R.value.find(T=>T.code==a.row.caseStatus))==null?void 0:S.name:""),1)]}),_:1}),l(v,{prop:"",label:"操作",width:"80px"},{default:o(a=>[r("div",{style:{display:"flex","align-items":"center",color:"#165dff",cursor:"pointer"},onClick:S=>H(a.row)}," 查看 ",8,Ae)]),_:1})]),_:1},8,["data"]),l(se,{class:"table_pagination","page-size":f.value.pageSize,"pager-count":f.value.pageSize,layout:"total, prev, pager, next",total:f.value.total,onCurrentChange:te},null,8,["page-size","pager-count","total"])]),r("div",Ee,[l(ue,{modelValue:y.value,"onUpdate:modelValue":e[12]||(e[12]=a=>y.value=a),title:"问题提报",width:"80%","show-close":!1},{footer:o(()=>[r("div",We,[l(m,{class:"cancel_btn",onClick:e[11]||(e[11]=a=>y.value=!1)},{default:o(()=>[g("取消")]),_:1}),l(m,{type:"primary",class:"primary_btn",onClick:J},{default:o(()=>[g("提交")]),_:1})])]),default:o(()=>[r("span",He,[r("span",je,[r("span",{class:F(M.value==1?"num_selected":"num")},"1",2),Ge]),r("span",Je,[r("span",{class:F(M.value==2?"num_selected":"num")},"2",2),Ke])]),r("div",Qe,[l(D,{model:u.value,rules:E.value,"label-width":"90px","label-position":"left"},{default:o(()=>[l(c,{label:"订单编号",prop:"orderNo"},{default:o(()=>[l(h,{modelValue:u.value.orderNo,"onUpdate:modelValue":e[6]||(e[6]=a=>u.value.orderNo=a),filterable:"",onChange:X,placeholder:"请选择订单编号"},{default:o(()=>[(b(!0),P($,null,L(U.value,a=>(b(),z(N,{key:a.po,label:a.po,value:a.neoid},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"提报人姓名",prop:"customerName"},{default:o(()=>[l(h,{modelValue:u.value.customerName,"onUpdate:modelValue":e[7]||(e[7]=a=>u.value.customerName=a),onChange:W,placeholder:"请选择提报人人员"},{default:o(()=>[(b(!0),P($,null,L(w.value,a=>(b(),z(N,{key:a.name,label:a.name,value:a.neoId},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(c,{label:"提报人电话",prop:"customerPhone"},{default:o(()=>[l(t,{placeholder:"请输入提报人电话",modelValue:u.value.customerPhone,"onUpdate:modelValue":e[8]||(e[8]=a=>u.value.customerPhone=a)},null,8,["modelValue"])]),_:1}),l(c,{label:"问题描述",class:"customLayout",prop:"desc"},{default:o(()=>[l(t,{modelValue:u.value.desc,"onUpdate:modelValue":e[9]||(e[9]=a=>u.value.desc=a),rows:5,type:"textarea",maxlength:"500",placeholder:"请输入问题描述","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(c,{label:"上传图片",class:"custom_upload"},{default:o(()=>[l(re,{"on-success":Z,"on-remove":ee,"auto-upload":!0,data:Y.value,headers:O.value,"before-upload":ae,"list-type":"picture-card",class:"avatar-uploader",action:"https://sh.mengtian.com.cn:9595/md/api/common/file/upload","show-file-list":!0,"file-list":u.value.fileList,"onUpdate:fileList":e[10]||(e[10]=a=>u.value.fileList=a)},{default:o(()=>[l(ne,null,{default:o(()=>[l(Ve(Ce))]),_:1})]),_:1},8,["data","headers","file-list"])]),_:1})]),_:1},8,["model","rules"])])]),_:1},8,["modelValue"])])])}}}),oa=De(Xe,[["__scopeId","data-v-9caff225"]]);export{oa as default};
