import{u as U}from"./userinfo-B4NFwAcm.js";import{w as x,s as B,l as C,a as D}from"./common-DNv9NPC-.js";import{d as F,g as T,r as c,a as M,o as R,c as h,b as A,w as d,F as J,e as f,p as O,f as G,h as m,i as I,t as X,j as q,_ as N}from"./index-DwwqDRnZ.js";const Q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAYdJREFUSEu1lDFLA0EQhWcuCIIgin9AQSRBLAQbbbRNp4KFegfaaCEIlskmGNAkloIiKILh7gTRIjaKlbWNxELInljkF9gG0exIEhJNvE2yC7lyb+fbN483g9ClD7vEBS3wuJkeLRkiDEIMVYShUeAOy/wVqQyeWEkPfgXEh0+nz9xhU7VzZXDQ3EsAGrt+FgrChTc3eltpQtXjkJm8J4SwpG69ZokyOGglSSomYIzwTKSgpVgGJoQXz2aT+h5b+y4ArjarJsBDz4nuaIPLhSErdU1ASw3xEjSdv4w9aYMlqbjiDlvWzrEsakQi7Lnxh5bganFgFoDmyheJ4MRz2ZZf+1UQHnAnGmn2vB634bXEQG+p5w4AZv5fwptmT6tMyHKbLfrFrw4eM1PzBlJWZWC4w6RzUP/RalTb7YWWihXAZ9xhm+06+1VsJTcA4FRegI+I4jhvxzqyq8Ejn3EtAkCOSJx7bvyinUpp3GoLHAGKhEbuu7/v9f1o+1MFqD15nT6ivDY7Bf8ADkOHFwvZKY0AAAAASUVORK5CYII=",j="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAWCAYAAADEtGw7AAAAAXNSR0IArs4c6QAAAihJREFUSEvN1E9o01AcB/Dv7yVZb0MFFQ/zMmbrpidXsEykguBBFCtOxBlF9KzCDqJdMWDrQBTBu0VMnSD4BwVRT70JdijI6hqVXRQsTLzMS9fk/ST749o1aSJSMMe87/vk9977vRA69FCHXISCtx7P7mZBoxA0SJJvb/xWv1ksGna7otrC245lexyVRplwvglhlARw42Mh/dAPb4Fjem4fWCZAYieABIBu38oIFZKYlMQlEBWte+kPy9kmOKpnhwnkW0XQeSgs+sqFS1/cXBMcO3HVAIkrQYDvOMs9lUKm+L/CVIagU2DeBObnC6v494qprEgcXd83/6k6oz0A48jfwHcrZvp0TM89A3BgZV8XUTuifCXbdtH9f8b8Ko7q2QsEurUUnFJYpFCrVZ2I9hKEIWARrXVhVrUxAfDexoN0IPs/m5nplsPbMjIeF0K+bQi/qaN+SCFVEyxeuSh1yTnHpgkGdq3qjncVM73Ds4+TSUP93qPNErBmZXn82l7bfTDy81ev1NQ6O/Z9gOMeLXe5YqbHPWH3Zexk7jEYqVUTH4HlFIRyGMzbvfqYwXHLHJv0hQfOGOucee09gM1hLwqD71jm2NnGvOdPaGDkWr8juBwOpjJrSsLKX5wLhN1AVM8OEqgUgP8Ay+HlaxwKdkO9urFBIy3f1KtLswnIS5bXrULG8vp44I8+aRhqdUY9R4wUAzEATwj8dNrMvGi3mkA43D63pjoG/waphdwXWEUOPAAAAABJRU5ErkJggg==",v=i=>(O("data-v-ac32c16e"),i=i(),G(),i),K=v(()=>m("div",{class:"main"},null,-1)),Y={class:"content"},L=v(()=>m("img",{src:Q,alt:""},null,-1)),P=v(()=>m("img",{src:j,alt:""},null,-1)),W={key:0,class:"sendCode"},Z=F({__name:"index",setup(i){const{proxy:n}=T(),l=c(0);U();const w=c(null),S=c(null),g=c(!1),u=c({userId:"",corpId:"",token:""}),a=M({phone:"",code:""});R(()=>{const s=window.location.href.indexOf("?"),o=s>=0?window.location.href.substring(s+1):window.location.href,e=new URLSearchParams(o).get("code");e&&(w.value=e,k())});const E=()=>{if(!a.phone){n.$message.error("手机号不能为空!");return}if(!/^1[3-9]\d{9}$/.test(a.phone)){n.$message.error("手机号不合法!");return}B({phone:a.phone}).then(o=>{o.data.code=="success"&&(l.value=60,y())})},k=async()=>new Promise(function(s){x({code:w.value,userType:2}).then(o=>{let t=o.data;if(console.info("wecom",o),t.code=="success"){let e=t.data||{};if(u.value=e,u.value.token){localStorage.setItem("token",e.token),sessionStorage.setItem("token",e.token);let p={id:e.id?e.id:null,neoid:e.neoId?e.neoId:null,name:e.name?e.name:null,phone:e.phone?e.phone:null,userType:e.userType?e.userType:null,store:e.store?e.store:null,distributor:e.distributor?e.distributor:null};localStorage.setItem("userinfo",JSON.stringify(p)),sessionStorage.setItem("userinfo",JSON.stringify(p)),V(),n.$router.push({path:"/main",query:{}})}else g.value=!0}else t.code=="get_wxwork_user_failed"?n.$router.push({path:"/login",query:{}}):(console.log("错误",o==null?void 0:o.message),n.$message.error("接口错误:",o==null?void 0:o.message));s(!0)})}),_=()=>{if(!a.phone){n.$message.error("手机号不能为空!");return}if(!/^1[3-9]\d{9}$/.test(a.phone)){n.$message.error("手机号不合法!");return}if(!a.code){n.$message.error("验证码不能为空!");return}C({phone:a.phone,captcha:a.code,userType:2}).then(o=>{let t=o.data;if(console.info("login",o),t.code=="success"){let e=t.data||{};localStorage.setItem("token",e.token),sessionStorage.setItem("token",e.token),b(e)}else n.$message.error("接口错误："+(o==null?void 0:o.message))})},b=async s=>{let o={id:s.id,neoId:s.neoId,phone:s.phone,name:s.name,corpId:u.value.corpId,userId:u.value.userId,userType:2};D(o).then(t=>{var e;((e=t==null?void 0:t.data)==null?void 0:e.code)=="success"?k():(console.log("失败"),n.$message.error("新增失败"))}).catch(t=>{console.error("新增失败:",t),n.$message.error("新增失败",t)})},y=()=>{S.value=setInterval(()=>{l.value>0?l.value-=1:clearInterval(S.value)},1e3)},V=()=>{var o,t;let s=((t=(o=n.$router)==null?void 0:o.options)==null?void 0:t.routes)||[];s.forEach(e=>{e.meta&&(e.meta.isAuth=!0)}),n.$router.options.routes=s};return(s,o)=>{const t=f("el-input"),e=f("el-button"),p=f("el-dialog");return I(),h(J,null,[K,A(p,{modelValue:g.value,"onUpdate:modelValue":o[2]||(o[2]=r=>g.value=r),title:"登录","close-on-click-modal":!1,"show-close":!1},{default:d(()=>[m("div",Y,[A(t,{class:"phone",placeholder:"请输入手机号",modelValue:a.phone,"onUpdate:modelValue":o[0]||(o[0]=r=>a.phone=r)},{prepend:d(()=>[L]),_:1},8,["modelValue"]),A(t,{class:"code",placeholder:"请输入验证码",modelValue:a.code,"onUpdate:modelValue":o[1]||(o[1]=r=>a.code=r)},{prepend:d(()=>[P]),append:d(()=>[l.value>0?(I(),h("span",W,X(l.value)+"s",1)):(I(),h("span",{key:1,class:"sendCode",onClick:E},"发送验证码"))]),_:1},8,["modelValue"]),A(e,{class:"login_btn",onClick:_},{default:d(()=>[q("登录")]),_:1})])]),_:1},8,["modelValue"])],64)}}}),ee=N(Z,[["__scopeId","data-v-ac32c16e"]]);export{ee as default};
